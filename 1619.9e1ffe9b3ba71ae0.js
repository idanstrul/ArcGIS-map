"use strict";var $e=Object.defineProperty,qe=Object.defineProperties,ti=Object.getOwnPropertyDescriptors,Te=Object.getOwnPropertySymbols,ei=Object.prototype.hasOwnProperty,ii=Object.prototype.propertyIsEnumerable,Ie=(Et,dt,d)=>dt in Et?$e(Et,dt,{enumerable:!0,configurable:!0,writable:!0,value:d}):Et[dt]=d,qt=(Et,dt)=>{for(var d in dt||(dt={}))ei.call(dt,d)&&Ie(Et,d,dt[d]);if(Te)for(var d of Te(dt))ii.call(dt,d)&&Ie(Et,d,dt[d]);return Et},te=(Et,dt)=>qe(Et,ti(dt));(self.webpackChunkKapow_Maps_Exam=self.webpackChunkKapow_Maps_Exam||[]).push([[1619],{25293:(Et,dt,d)=>{d.d(dt,{i:()=>ct});var Y=d(72283),ot=d(11004);class ct{static getPlacement(R,Q,J,U){const k=(0,ot.W)(Q);if(!k)return null;const H=(0,Y.GP)(R);return k.execute(H,Q,J,U)}}},55130:(Et,dt,d)=>{d.d(dt,{_:()=>vt}),d(17083),d(9598);var ct=d(58098),Q=(d(8480),d(79527),d(39351)),J=d(99666),U=d(39406),k=d(64288);const H=new Map;H.set(U.LW.MARKER,{multiplier:1,indicesPerRecord:6,verticesPerRecord:4}),H.set(U.LW.LINE,{multiplier:1,indicesPerRecord:24,verticesPerRecord:8}),H.set(U.LW.FILL,{multiplier:1,indicesPerRecord:10,verticesPerRecord:10}),H.set(U.LW.TEXT,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4}),H.set(U.LW.LABEL,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4});var g=d(75734);class S{constructor(T,N,nt){this._start={index:0,vertex:0};const K=function Tt(xt,T,N){const{indicesPerRecord:nt,multiplier:K,verticesPerRecord:at}=H.get(xt);return{recordBytes:N*Q.XJ*Uint32Array.BYTES_PER_ELEMENT,indexBytes:K*nt*N*Uint32Array.BYTES_PER_ELEMENT,vertexBytes:K*at*N*T}}(T,N,nt),at=N/4;this.geometryType=T,this._records=new g.Z(Int32Array,K.recordBytes),this._indices=new g.Z(Uint32Array,K.indexBytes),this._vertices=new g.Z(Uint32Array,K.vertexBytes),this._metrics=new g.Z(Float32Array,0),this._strideInt=at}serialize(T){const N=this._records.buffer(),nt=this._indices.buffer(),K=this._vertices.buffer(),at=this._metrics.length?this._metrics.buffer():null,mt=4*this._strideInt;return T.push(N,nt,K),{stride:mt,records:N,indices:nt,vertices:K,metrics:at}}get strideInt(){return this._strideInt}get recordCount(){return this._records.length/Q.XJ}get vertexCount(){return this._vertices.length/this._strideInt}get indexCount(){return this._indices.length}get indexWriter(){return this._indices}get vertexWriter(){return this._vertices}get metricWriter(){return this._metrics}vertexEnsureSize(T){this._vertices.ensureSize(T)}indexEnsureSize(T){this._indices.ensureSize(T)}recordStart(){this._start.index=this._indices.length,this._start.vertex=this._vertices.length}recordEnd(T,N,nt,K,at,mt,Lt,gt){this._records.push(T),this._records.push(N),this._records.push(nt),this._records.push(K),this._records.push(at),this._records.push(mt),this._records.push(Lt),this._records.writeF32(gt)}writeIndex(T){this._indices.push(T)}writeVertex(T){this._vertices.push(T)}writeVertexF32(T){this._vertices.writeF32(T)}copyLastFrom(T,N,nt){const K=T._records.length-Q.XJ,at=T._records.getValue(K),mt=T._records.getValue(K+1),Lt=T._records.getValue(K+2),gt=T._records.getValue(K+4),ft=T._records.getValue(K+6),Ot=T._records.getValue(K+7),St=this._vertices.length,Kt=(T._start.vertex-this._vertices.length)/this._strideInt,Ft=this._indices.length,Jt=this.vertexCount;for(let w=T._start.index;w!==T._indices.length;w++){const h=T._indices.getValue(w);this._indices.push(h-Kt)}for(let w=T._start.vertex;w!==T._vertices.length;w++){const h=T._vertices.getValue(w);this._vertices.push(h)}for(let w=St;w<=this._vertices.length;w+=this._strideInt)this._vertices.i1616Add(w,N,nt);this._records.push(at),this._records.push(mt),this._records.push(Lt),this._records.push(Ft),this._records.push(gt),this._records.push(Jt),this._records.push(ft),this._records.push(Ot)}}var a=d(55376);function A(xt){switch(xt){case 1:case 8:case 32:return-1;case 2:case 64:return 0;case 4:case 16:case 128:return 1}}function rt(xt){switch(xt){case 1:case 2:case 4:return-1;case 8:case 16:return 0;case 32:case 64:case 128:return 1}}class vt{constructor(T,N,nt,K,at){this._hasAggregate=!1,this.hasRecords=!1,this._data={self:new Map,neighbors:new Array},this._current={geometryType:0,writer:null,overlaps:0,start:0,insertAfter:0,sortKey:0,id:0,materialKey:0,indexStart:0,vertStart:0,isDotDensity:!1,bufferingEnabled:!1,metricBoxLenPointer:0},this.hint=N,this.tileKey=T,this._hasAggregate=K,this._pixelBufferEnabled=at,this._strideOptions=nt}get hasAggregates(){return this._hasAggregate}get hasPixelBufferEnabled(){return this._pixelBufferEnabled}serialize(T){const N=[];return N.push(this._serializeTileVertexData(this.tileKey,this.tileKey,this._data.self)),this._data.neighbors.forEach((nt,K)=>{const at=1<<K,mt=A(at),Lt=rt(at),gt=(0,a.M)(new ct.Z(this.tileKey),mt,Lt,T),ft=this._serializeTileVertexData(this.tileKey,gt.id,nt.vertexData);ft.message.bufferIds=nt.displayIds,N.push(ft)}),N}_serializeTileVertexData(T,N,nt){var K,at,mt,Lt,gt;const ft=new Array;return{message:{tileKeyOrigin:T,tileKey:N,data:{[U.LW.MARKER]:null==(K=nt.get(U.LW.MARKER))?void 0:K.serialize(ft),[U.LW.FILL]:null==(at=nt.get(U.LW.FILL))?void 0:at.serialize(ft),[U.LW.LINE]:null==(mt=nt.get(U.LW.LINE))?void 0:mt.serialize(ft),[U.LW.TEXT]:null==(Lt=nt.get(U.LW.TEXT))?void 0:Lt.serialize(ft),[U.LW.LABEL]:null==(gt=nt.get(U.LW.LABEL))?void 0:gt.serialize(ft)}},transferList:ft}}featureStart(T,N){this._current.insertAfter=T,this._current.sortKey=N}featureEnd(){}recordStart(T,N,nt,K){this._current.writer=this._getVertexWriter(nt),this._current.overlaps=0,this._current.indexStart=this._current.writer.indexCount,this._current.vertStart=this._current.writer.vertexCount,this._current.bufferingEnabled=K,this._current.id=T,this._current.materialKey=N,this._current.geometryType=nt,this._current.isDotDensity=!1,this._current.writer.recordStart()}recordCount(){return this._current.writer.recordCount}vertexCount(){return this._current.writer.vertexCount}indexCount(){return this._current.writer.indexCount}vertexEnsureSize(T){this._current.writer.vertexEnsureSize(T)}indexEnsureSize(T){this._current.writer.indexEnsureSize(T)}vertexBounds(T,N,nt,K){this._current.bufferingEnabled&&this._addOverlap(T,N,nt,K)}vertexWrite(T){this._current.writer.writeVertex(T)}vertexWriteF32(T){this._current.writer.writeVertexF32(T)}vertexEnd(){}vertexWriter(){return this._current.writer.vertexWriter}indexWrite(T){this._current.writer.writeIndex(T)}indexWriter(){return this._current.writer.indexWriter}metricWriter(){return this._current.writer.metricWriter}metricStart(T,N,nt,K,at,mt,Lt,gt){this._current.writer=this._getVertexWriter(U.LW.LABEL);const ft=this._current.writer.metricWriter;ft.push((0,J.jL)(T)),ft.push(N),ft.push(nt),ft.push(K),ft.push(at),ft.push(mt),ft.push(Lt),ft.push(gt),ft.push(255),this._current.metricBoxLenPointer=ft.push(0)}metricEnd(){const T=this._current.writer.metricWriter;0===T.getValue(this._current.metricBoxLenPointer)&&T.seek(T.length-10)}metricBoxWrite(T,N,nt,K){const at=this._current.writer.metricWriter;at.incr(this._current.metricBoxLenPointer),at.push(0),at.push(0),at.push(T),at.push(N),at.push(nt),at.push(K)}recordEnd(){const T=this._current.vertStart,N=this._current.writer.vertexCount-T;if(!N)return!1;this.hasRecords=!0;const nt=this._current.indexStart;if(this._current.writer.recordEnd(this._current.id,this._current.materialKey,this._current.insertAfter,nt,this._current.writer.indexCount-nt,T,N,this._current.sortKey),!this._pixelBufferEnabled||this._hasAggregate||0===this._current.overlaps||this._current.geometryType===U.LW.LABEL)return!0;const at=this._current.writer;for(let mt=0;mt<8;mt++){const Lt=1<<mt;if(this._current.overlaps&Lt){this._data.neighbors[mt]||(this._data.neighbors[mt]={vertexData:new Map,displayIds:new Set});const gt=this._data.neighbors[mt],ft=this._current.geometryType;if(!gt.vertexData.has(ft)){const Jt=(0,k.$_)(ft,this._strideOptions).geometry,w=new S(ft,Jt,Q.Ip);gt.vertexData.set(ft,w)}const Ot=gt.vertexData.get(this._current.geometryType),St=8,Kt=512*-A(Lt)*St,Ft=512*-rt(Lt)*St;Ot.copyLastFrom(at,Kt,Ft),gt.displayIds.add(this._current.id)}}return!0}_addOverlap(T,N,nt,K){this._current.overlaps|=255^((T<0+nt?148:T>=Q.I_-nt?41:189)|(N<0+K?224:N>=Q.I_-K?7:231))}_getVertexWriter(T){if(!this._data.self.has(T)){const N=this._data.self,nt=(0,k.$_)(T,this._strideOptions).geometry;N.set(T,new S(T,nt,this.hint.records))}return this._data.self.get(T)}}},246:(Et,dt,d)=>{d.d(dt,{j:()=>Jt});var Y=d(15861),ct=(d(8314),d(62208)),F=d(10699),R=d(58774),Q=d(99666),J=d(26584),U=d(63290),k=d(21286),H=d(23841),V=d(7547),Tt=d(61261),g=d(81295),S=d(39351),a=d(39406),y=d(5254),Z=d(18716),$=d(50114);function D(w){return w.length-1}function x(w,h,m=1){const[p,I]=function q(w,h){return w[h+1]}(w,h);return Math.sqrt(p*p+I*I)*m}class W{constructor(h,m,p,I,b){this._segments=h,this._index=m,this._distance=p,this._xStart=I,this._yStart=b,this._done=!1}static create(h){return new W(h,0,0,h[0][0],h[0][1])}clone(){return new W(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(h){return this._index===h._index||h._index===this._index-1&&(0===this._distance||1===h._distance)||h._index===this._index+1&&(1===this._distance||0===h._distance)}leq(h){return this._index<h._index||this._index===h._index&&this._distance<=h._distance}geq(h){return this._index>h._index||this._index===h._index&&this._distance>=h._distance}get _segment(){return this._segments[this._index+1]}get angle(){const h=this.dy;let p=Math.acos((0*h+-1*-this.dx)/(1*this.length));return h>0&&(p=2*Math.PI-p),p}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const{dx:h,dy:m}=this;return Math.sqrt(h*h+m*m)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return this._index-1>=0}hasNext(){return this._index+1<D(this._segments)}next(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}prev(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}_seekBackwards(h,m){const p=this.backwardLength;if(h<=p)return this._distance=(p-h)/this.length,this;let I=this.backwardLength;for(;this.prev();){if(I+this.length>h)return this._seekBackwards(h-I);I+=this.length}return this._distance=0,m?this:null}seek(h,m=!1){if(h<0)return this._seekBackwards(Math.abs(h),m);if(h<=this.remainingLength)return this._distance=(this.backwardLength+h)/this.length,this;let p=this.remainingLength;for(;this.next();){if(p+this.length>h)return this.seek(h-p,m);p+=this.length}return this._distance=1,m?this:null}}function A(w,h,m,p=!0){const I=function B(w){let h=0;for(let m=0;m<D(w);m++)h+=x(w,m);return h}(w),b=W.create(w),O=I/2;if(!p)return b.seek(O),void m(b.clone(),0,O+0*h,I);const X=Math.max((I-h)/2,0),tt=Math.floor(X/h);b.seek(O-tt*h);for(let _t=-tt;_t<=tt;_t++)b.x<512&&b.x>=0&&b.y<512&&b.y>=0&&m(b.clone(),_t,O+_t*h,I),b.seek(h)}function lt(w,h){if(h<=0)return;const p=w.length;if(p<3)return;const I=[];let b=0;I.push(0);for(let G=1;G<p;G++)b+=(0,$.TK)(w[G],w[G-1]),I.push(b);h=Math.min(h,.2*b);const O=[];O.push(w[0][0]),O.push(w[0][1]);const X=w[p-1][0],tt=w[p-1][1],ht=(0,$.lu)([0,0],w[0],w[1]);(0,$.Fv)(ht),w[0][0]+=h*ht[0],w[0][1]+=h*ht[1],(0,$.lu)(ht,w[p-1],w[p-2]),(0,$.Fv)(ht),w[p-1][0]+=h*ht[0],w[p-1][1]+=h*ht[1];for(let G=1;G<p;G++)I[G]+=h;I[p-1]+=h;const _t=.5*h;for(let G=1;G<p-1;G++){let Mt=0,Pt=0,Vt=0;for(let pt=G-1;pt>=0&&!(I[pt+1]<I[G]-_t);pt--){const zt=_t+I[pt+1]-I[G],Wt=I[pt+1]-I[pt],It=I[G]-I[pt]<_t?1:zt/Wt;if(Math.abs(It)<1e-6)break;const Bt=It*It,At=It*zt-.5*Bt*Wt,Gt=It*Wt/h,bt=w[pt+1],wt=w[pt][0]-bt[0],Ht=w[pt][1]-bt[1];Mt+=Gt/At*(bt[0]*It*zt+.5*Bt*(zt*wt-Wt*bt[0])-Bt*It*Wt*wt/3),Pt+=Gt/At*(bt[1]*It*zt+.5*Bt*(zt*Ht-Wt*bt[1])-Bt*It*Wt*Ht/3),Vt+=Gt}for(let pt=G+1;pt<p&&!(I[pt-1]>I[G]+_t);pt++){const zt=_t-I[pt-1]+I[G],Wt=I[pt]-I[pt-1],It=I[pt]-I[G]<_t?1:zt/Wt;if(Math.abs(It)<1e-6)break;const Bt=It*It,At=It*zt-.5*Bt*Wt,Gt=It*Wt/h,bt=w[pt-1],wt=w[pt][0]-bt[0],Ht=w[pt][1]-bt[1];Mt+=Gt/At*(bt[0]*It*zt+.5*Bt*(zt*wt-Wt*bt[0])-Bt*It*Wt*wt/3),Pt+=Gt/At*(bt[1]*It*zt+.5*Bt*(zt*Ht-Wt*bt[1])-Bt*It*Wt*Ht/3),Vt+=Gt}O.push(Mt/Vt),O.push(Pt/Vt)}O.push(X),O.push(tt);for(let G=0,Mt=0;G<p;G++)w[G][0]=O[Mt++],w[G][1]=O[Mt++]}var ut=d(51919);const vt=U.Z.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate"),Lt=function mt(w){const h=new Map;return m=>(h.has(m)||h.set(m,w(m)),h.get(m))}(w=>{let h=0;if(0===w)return 1/0;for(;!(w%2);)h++,w/=2;return h}),gt=w=>Math.floor(127*w+127),ft=w=>Math.floor(10*w),Ot=w=>Math.round(w*(254/360));class St extends ut.Z{constructor(h,m,p,I){var b,O,X;super(h,p.font.size,p.haloSize||0,p.font.size,p.color&&(0,g.aH)(p.color)||0,p.haloColor&&(0,g.aH)(p.haloColor)||0,p.horizontalAlignment,p.verticalAlignment,(0,Tt.NS)(m.labelPlacement)?V.v2.MAP:V.v2.SCREEN,p.font.decoration,!1,p.angle||0,p.xoffset,p.yoffset,p.lineWidth,p.lineHeight,null,null,null,null,null),this._outLineLabelAngle=0,this._refPlacementPadding=0,this._refPlacementDirX=0,this._refPlacementDirY=0,this._refOffsetX=0,this._refOffsetY=0,this._zoomLevel=0,this.geometryType=a.LW.LABEL,this._allowOverrun=null!=(b=m.allowOverrun)&&b,this._repeatLabel=null==(O=m.repeatLabel)||O,this._labelPosition=null!=(X=m.labelPosition)?X:"curved";const tt=function K(w,h){const m=!!w.minScale&&h.scaleToZoom(w.minScale)||0;return(0,k.uZ)(m,0,25.5)}(m,I),ht=function at(w,h){const m=!!w.maxScale&&h.scaleToZoom(w.maxScale)||255;return(0,k.uZ)(m,0,25.5)}(m,I),_t=m.labelPlacement,[G,Mt]=(0,Tt.qv)(_t);this._xAlignD=G,this._yAlignD=Mt,this._minZoom=tt,this._maxZoom=ht,this._refPlacementPadding=(0,H.F2)(p.haloSize)+S.Iw,this._repeatLabelDistance=m.repeatLabelDistance?(0,H.F2)(m.repeatLabelDistance):128;const Pt=Z.Gq.load(h);Pt.sdf=!0,this._materialKey=Pt.data}static fromLabelClass(h,m){if("esriServerLinePlacementCenterAlong"===h.labelPlacement){const p=h.symbol;p.xoffset=0,p.yoffset=0,p.angle=0,p.font.decoration="none"}return new St(h.materialKey,h,h.symbol,m)}get _shapedBox(){return(0,ct.Wg)(this._shapingInfo).bounds}setZoomLevel(h){this._zoomLevel=h}bindReferenceTemplate(h){let m=(0,Tt.g)(this._xAlignD),p=(0,Tt.tf)(this._yAlignD);if(this._refOffsetX=0,this._refOffsetY=0,(0,ct.Wi)(h))return void(this._refSymbolAndPlacementOffset=(0,y.Jz)(0,0,gt(m),gt(p)));if("circle"===h.boundsType&&(m||p)){const O=Math.sqrt(m*m+p*p);m/=O,p/=O}const I=Math.max(h.height,h.width);this._refSymbolAndPlacementOffset=(0,y.Jz)(4*this._refPlacementPadding,I,gt(m),gt(p)),this._referenceSize=I,this._refPlacementDirX=m,this._refPlacementDirY=p,this._refOffsetX=h.xOffset,this._refOffsetY=h.yOffset}_write(h,m){if((0,ct.Wi)(this._shapingInfo))return;const p=this._shapingInfo,I=m.getDisplayId(),b="esriGeometryPolygon"===m.geometryType?m.readLegacyCentroid():m.readLegacyGeometry();if(b)switch(this.current={out:h,inId:I,inShaping:p,zoomLevel:this._zoomLevel},m.geometryType){case"esriGeometryPolyline":this._placeLineLabels(b);break;case"esriGeometryPoint":case"esriGeometryPolygon":this._placePointLabels(b);break;default:((w,h="mapview-labeling")=>{vt.error(new J.Z(h,"mapview-labeling"))})(0,`Geometry of type ${m.geometryType} is not supported`)}}_isVisible(h,m){const p=ft(this.current.zoomLevel);return ft(h)<=p&&p<=ft(m)}_placePointLabels(h){const{out:m,inId:p,inShaping:I}=this.current;this._writeGlyphs(m,p,h,I)}_placeLineLabels(h){const m=function j(w,h){const m=h;for(let p=0;p<w.length;p++){let I=w[p];const b=[];b.push(I[0]);for(let X=1;X<I.length;X++){let[tt,ht]=b[X-1];tt+=I[X][0],ht+=I[X][1],b.push([tt,ht])}lt(b,m);const O=[];O.push(b[0]);for(let X=1;X<b.length;X++){const[tt,ht]=b[X-1],[_t,G]=b[X],Mt=Math.round(_t-tt),Pt=Math.round(G-ht);O.push([Mt,Pt])}w[p]=O,I=O}return w}(h.paths,this.current.inShaping.bounds.width),p=this._placeSubdivGlyphs.bind(this),I=(this._shapedBox.width+this._repeatLabelDistance)/2;for(const b of m)A(b,I,p,this._repeatLabel)}_placeSubdivGlyphs(h,m,p,I){const b=Lt(m),O=this._shapedBox.width/2,X=Math.sqrt(this._repeatLabelDistance)/2,tt=Math.min(p,I-p),ht=Math.log2(tt/(X+O/2)),_t=0===m?ht:Math.min(b,ht),G=Math.max(this._minZoom,this.current.zoomLevel+1-_t),Mt=this.current.zoomLevel-G,Pt=this._shapedBox.width/2*2**Mt;this.current.inShaping.isMultiline?0===m&&this._placeStraight(h,G):this._allowOverrun&&Mt<0?this._placeStraightAlong(h,this._minZoom):"parallel"===this._labelPosition?this._placeStraightAlong(h,G):"curved"===this._labelPosition&&this._placeCurved(h,G,Pt)}_placeStraight(h,m){const{out:p,inId:I,inShaping:b}=this.current;this._writeGlyphs(p,I,h,b,m)}_placeCurved(h,m,p){const{out:I,inId:b}=this.current;I.metricStart(b,m,h.x,h.y,0,0,0,0);const O=h.clone(),X=h.angle*(180/Math.PI)%360,tt=(h.angle*(180/Math.PI)+180)%360;this._outLineLabelAngle=Ot(X),this._placeFirst(O,m,1),this._placeBack(h,O,m,p,1),this._placeForward(h,O,m,p,1),this._outLineLabelAngle=Ot(tt),this._placeFirst(O,m,0),this._placeBack(h,O,m,p,0),this._placeForward(h,O,m,p,0),I.metricEnd()}_placeStraightAlong(h,m){const{out:p,inId:I}=this.current;p.metricStart(I,m,h.x,h.y,0,0,0,0);const b=h.clone(),O=h.angle*(180/Math.PI)%360,X=(h.angle*(180/Math.PI)+180)%360;this._outLineLabelAngle=Ot(O),this._placeFirst(b,m,1,!0),this._outLineLabelAngle=Ot(X),this._placeFirst(b,m,0,!0),p.metricEnd()}_placeBack(h,m,p,I,b){const O=h.clone();let X=h.backwardLength+0;for(;O.prev()&&!(X>=I);)this._placeOnSegment(O,m,X,p,-1,b),X+=O.length+0}_placeForward(h,m,p,I,b){const O=h.clone();let X=h.remainingLength+0;for(;O.next()&&!(X>=I);)this._placeOnSegment(O,m,X,p,1,b),X+=O.length+0}_placeFirst(h,m,p,I=!1){const b=h,O=this.current.inShaping,X=O.glyphs,tt=this.current.zoomLevel,{out:ht,inId:_t}=this.current;for(const G of X){const Mt=G.x>O.bounds.x?p:1-p,Pt=Mt*h.remainingLength+(1-Mt)*h.backwardLength,Vt=Math.abs(G.x+G.width/2-O.bounds.x),pt=Math.max(0,tt+Math.log2(Vt/(Pt+0))),zt=Math.max(m,I?0:pt);if(G.maxZoom=25,G.angle=h.angle+(1-p)*Math.PI,G.minZoom=zt,this._writeGlyph(ht,_t,b.x,b.y,G),p&&this._isVisible(G.minZoom,G.maxZoom)){const Wt=G.bounds;ht.metricBoxWrite(Wt.center[0],Wt.center[1],Wt.width,Wt.height)}}}_placeOnSegment(h,m,p,I,b,O){const X=this.current.inShaping.glyphs,{out:tt,inId:ht}=this.current,_t=this.current.inShaping,G=this.current.zoomLevel,Vt={x:h.x+p*-b*(h.dx/h.length),y:h.y+p*-b*(h.dy/h.length)};for(const pt of X){const zt=pt.x>_t.bounds.x?O:1-O;if(!(zt&&1===b||!zt&&-1===b))continue;const Wt=Math.abs(pt.x+pt.width/2-_t.bounds.x),It=Math.max(0,G+Math.log2(Wt/p)-.1),Bt=Math.max(I,G+Math.log2(Wt/(p+h.length+0)));if(0!==It&&(pt.angle=h.angle+(1-O)*Math.PI,pt.minZoom=Bt,pt.maxZoom=It,this._writeGlyph(tt,ht,Vt.x,Vt.y,pt),O&&this._isVisible(pt.minZoom,pt.maxZoom))){const At=pt.bounds;tt.metricBoxWrite(At.center[0]+(h.x-m.x),At.center[1]+(h.y-m.y),At.width,At.height)}}}_writeGlyphs(h,m,p,I,b=this._minZoom){if(p.x<0||p.x>=512||p.y<0||p.y>=512)return;const O=p.x+this._refOffsetX,X=p.y-this._refOffsetY;for(const G of I.glyphs)G.minZoom=b,G.maxZoom=this._maxZoom,this._writeGlyph(h,m,O,X,G);const _t=I.boundsT;h.metricStart(m,b,O,X,this._refPlacementDirX,this._refPlacementDirY,this._referenceSize,this._materialKey),h.metricBoxWrite(_t.center[0],_t.center[1],_t.width,_t.height),h.metricEnd()}_writeVertexCommon(h,m,p,I){const b=this._color,O=this._haloColor,X=(0,y.Jz)(0,0,this._size,this._haloSize),tt=Math.max(I.minZoom,this._minZoom),ht=Math.min(I.maxZoom,this._maxZoom),_t=(0,y.Jz)(ft(tt),ft(ht),this._outLineLabelAngle,0);h.vertexWrite(p),h.vertexWrite(m),h.vertexWrite(b),h.vertexWrite(O),h.vertexWrite(X),h.vertexWrite(this._refSymbolAndPlacementOffset),h.vertexWrite(_t)}}var Kt=d(18752),Ft=d(1825);class Jt{constructor(h,m,p){this._loadPromise=(0,R.j)(),this._geometryType=h,this._idField=m,this._templateStore=p}update(h,m){(0,ct.pC)(h.mesh.labels)&&(this._labelTemplates=this._createLabelTemplates(h.mesh.labels,m)),this._schema=h}_createLabelTemplates(h,m){const p=new Map;if("simple"===h.type){for(const I of h.classes){const b=St.fromLabelClass(I,m);p.set(I.index,b)}return p}for(const I in h.classes){const b=h.classes[I];for(const O of b){const X=St.fromLabelClass(O,m);p.set(O.index,X)}}return p}get templates(){return this._templateStore}analyze(h,m,p,I,b,O,X){var tt=this;return(0,Y.Z)(function*(){if((0,F.Hc)(X))return;let ht;"dictionary"===p.type&&(ht=yield p.analyze(tt._idField,h.copy(),m,b,O,X));let _t=0;for(;h.next();){let G;if(G=ht?ht[_t++]:(0,ct.pC)(I)&&(0,Q.nE)(h.getDisplayId())&&1!==h.readAttribute("cluster_count")?I.match(tt._idField,h,tt._geometryType,b,O):p.match(tt._idField,h,tt._geometryType,b,O),h.setGroupId(G),(0,Ft.Sl)(G)){const Mt=tt._templateStore.getDynamicTemplateGroup(G);for(const Pt of Mt)Pt&&Pt.analyze&&Pt.analyze(tt._templateStore,h,b,O)}}return yield tt._loadPromise,tt._templateStore.finalize(X)})()}analyzeGraphics(h,m,p,I,b,O){var X=this;return(0,Y.Z)(function*(){if((0,F.Hc)(O))return;const tt=h.getCursor();for(p&&(yield p.analyze(X._idField,tt.copy(),m,I,b,O));tt.next();){let ht=tt.getGroupId();if(null!=ht&&-1!==ht||(ht=p.match(X._idField,tt,tt.geometryType,I,b),tt.setGroupId(ht)),(0,Ft.Sl)(ht)){const _t=X._templateStore.getDynamicTemplateGroup(ht);for(const G of _t)G&&G.analyze&&G.analyze(X._templateStore,tt,I,b)}tt.setGroupId(ht)}return yield X._loadPromise,X._templateStore.finalize(O)})()}writeGraphic(h,m,p,I){const b=m.getGroupId(),O=m.getDisplayId(),X=this._templateStore.getTemplateGroup(b);if(h.featureStart(m.insertAfter,0),null!=O){if((0,Ft.Sl)(b))for(const tt of X)tt&&tt.bindFeature(m,null,null);if(X){for(const tt of X)tt&&tt.write(h,m,p,I);h.featureEnd()}}}writeCursor(h,m,p,I,b,O,X){const tt=m.getGroupId(),ht=m.getDisplayId(),_t=this._templateStore.getTemplateGroup(tt),G=this._schema.mesh.sortKey;let Mt=0;if((0,ct.pC)(G)&&(Mt=null!=G.fieldIndex?m.getComputedNumericAtIndex(G.fieldIndex):m.readAttribute(null!=G.field?G.field:this._idField),Mt*="asc"===G.order?1:-1),h.featureStart(0,null==Mt||isNaN(Mt)?0:Mt),null!=ht&&_t){if((0,Ft.Sl)(tt))for(const Pt of _t)Pt.bindFeature(m,p,I);for(const Pt of _t)Pt.write(h,m,b,X);if((0,ct.pC)(O)&&h.hasRecords){const Pt=O&&this._findLabelRef(_t);this._writeLabels(h,m,O,Pt,b,X)}h.featureEnd()}}_findLabelRef(h){for(const m of h)if(m instanceof Kt.Z)return m;return null}_writeLabels(h,m,p,I,b,O){for(const X of p)if((0,ct.pC)(X)&&X){const{glyphs:tt,rtl:ht,index:_t}=X,G=this._labelTemplates.get(_t);G.setZoomLevel(b),G.bindReferenceTemplate(I),G.bindTextInfo(tt,ht),G.write(h,m,null,O)}}}},88337:(Et,dt,d)=>{d.d(dt,{Z:()=>g});var Y=d(62208),ot=d(23841),ct=d(31478),F=d(12225),R=d(67831),Q=d(9545),J=d(82054),U=d(25293),k=d(39406),H=d(5254);const V=3.14159265359/180,g=S=>class extends S{constructor(...a){super(...a),this.angle=0,this.xOffset=0,this.yOffset=0,this.width=0,this.height=0,this.boundsType="square",this._anchorX=0,this._anchorY=0,this._computedWidth=0,this._computedHeight=0,this._vertexBoundsScaleX=1,this._vertexBoundsScaleY=1,this._offsets={xUpperLeft:0,yUpperLeft:0,xUpperRight:0,yUpperRight:0,xBottomLeft:0,yBottomLeft:0,xBottomRight:0,yBottomRight:0},this.geometryType=k.LW.MARKER}_write(a,y,Z,$){const q=y.getDisplayId();a.recordStart(q,this._materialKey,this.geometryType,!0),this._writeGeometry(a,y,q,Z,$),a.recordEnd()}_writeGeometry(a,y,Z,$,q){if((0,Y.pC)(this._markerPlacement))return this._writePlacedMarkers(a,y,$,q);if(!q&&"esriGeometryPoint"===y.geometryType){const B=y.getX(),x=y.getY();return!a.hasAggregates&&a.hasPixelBufferEnabled&&(B<0||B>=513||x<0||x>=513)?void 0:this._writeVertices(a,Z,this._getPos(B,x),B,x)}const D=q?(0,J.oB)((0,J.GH)(q),2):"esriGeometryPolygon"===y.geometryType?y.readCentroid():y.readGeometryForDisplay();if(!(0,Y.Wi)(D)){if(D.isPoint){const[B,x]=D.coords;return!a.hasAggregates&&a.hasPixelBufferEnabled&&(B<0||B>=512||x<0||x>=512)?void 0:this._writeVertices(a,Z,this._getPos(B,x),B,x)}D.forEachVertex((B,x)=>this._writeVertices(a,Z,this._getPos(B,x),B,x))}}_writePlacedMarkers(a,y,Z,$){const q=null!=$?$:y.readLegacyGeometryForDisplay(),D=U.i.getPlacement(q,(0,Y.Wg)(this._markerPlacement),(0,ot.F2)(1),Z.geometryEngine);if(!D)return;const B=y.getDisplayId(),x=(0,Q.c)(),W=(0,F.c)();let st=D.next();for(;null!=st;){const j=st.tx,lt=-st.ty;j>=-128&&j<=640&&lt>=-128&&lt<=640&&(this._applyTransformation(W,x,-st.getAngle()/V),this._writeVertices(a,B,this._getPos(j,lt),j,lt)),st=D.next()}}_writeVertices(a,y,Z,$,q){const D=a.vertexCount();if(this.angle){const B=Math.max(this._computedWidth*this._vertexBoundsScaleX,this._computedHeight*this._vertexBoundsScaleY);a.vertexBounds($+this.xOffset,q-this.yOffset,B,B)}else a.vertexBounds($+this.xOffset,q-this.yOffset,this._computedWidth*this._vertexBoundsScaleX,this._computedHeight*this._vertexBoundsScaleY);a.vertexWrite(Z),a.vertexWrite(this._offsetUpperLeft),a.vertexWrite(this._texUpperLeft),a.vertexWrite(this._bitestAndDistRatio),a.vertexWrite(y),a.vertexWrite(this._fillColor),a.vertexWrite(this._outlineColor),a.vertexWrite(this._sizeOutlineWidth),a.vertexWrite(this._minMaxZoom),a.vertexEnd(),a.vertexWrite(Z),a.vertexWrite(this._offsetUpperRight),a.vertexWrite(this._texUpperRight),a.vertexWrite(this._bitestAndDistRatio),a.vertexWrite(y),a.vertexWrite(this._fillColor),a.vertexWrite(this._outlineColor),a.vertexWrite(this._sizeOutlineWidth),a.vertexWrite(this._minMaxZoom),a.vertexEnd(),a.vertexWrite(Z),a.vertexWrite(this._offsetBottomLeft),a.vertexWrite(this._texBottomLeft),a.vertexWrite(this._bitestAndDistRatio),a.vertexWrite(y),a.vertexWrite(this._fillColor),a.vertexWrite(this._outlineColor),a.vertexWrite(this._sizeOutlineWidth),a.vertexWrite(this._minMaxZoom),a.vertexEnd(),a.vertexWrite(Z),a.vertexWrite(this._offsetBottomRight),a.vertexWrite(this._texBottomRight),a.vertexWrite(this._bitestAndDistRatio),a.vertexWrite(y),a.vertexWrite(this._fillColor),a.vertexWrite(this._outlineColor),a.vertexWrite(this._sizeOutlineWidth),a.vertexWrite(this._minMaxZoom),a.vertexEnd(),a.indexWrite(D+0),a.indexWrite(D+1),a.indexWrite(D+2),a.indexWrite(D+1),a.indexWrite(D+3),a.indexWrite(D+2)}_applyTransformation(a,y,Z=0){(0,ct.a)(a,(0,Q.f)(this.xOffset,-this.yOffset)),this.angle+Z!==0&&(0,ct.r)(a,a,V*(this.angle+Z));const $=this._computedWidth,q=this._computedHeight,D=(this._anchorX-.5)*$,B=(this._anchorY-.5)*q;(0,R.s)(y,D,B),(0,R.t)(y,y,a),this._offsetUpperLeft=(0,H.UJ)(16*y[0],16*y[1]),this._offsets.xUpperLeft=y[0],this._offsets.yUpperLeft=y[1],(0,R.s)(y,D+$,B),(0,R.t)(y,y,a),this._offsetUpperRight=(0,H.UJ)(16*y[0],16*y[1]),this._offsets.xUpperRight=y[0],this._offsets.yUpperRight=y[1],(0,R.s)(y,D,B+q),(0,R.t)(y,y,a),this._offsetBottomLeft=(0,H.UJ)(16*y[0],16*y[1]),this._offsets.xBottomLeft=y[0],this._offsets.yBottomLeft=y[1],(0,R.s)(y,D+$,B+q),(0,R.t)(y,y,a),this._offsetBottomRight=(0,H.UJ)(16*y[0],16*y[1]),this._offsets.xBottomRight=y[0],this._offsets.yBottomRight=y[1]}_getPos(a,y){return(0,H.UJ)(Math.round(8*a),Math.round(8*y))}}},44526:(Et,dt,d)=>{d.d(dt,{Z:()=>V});var Y=d(62208),ot=d(23841),ct=d(82054),F=d(25293),R=d(39351),Q=d(39406),J=d(5254),U=d(18716),k=d(25797);const V=Tt=>class extends Tt{constructor(...g){super(...g),this._isCIM=!1,this._vertexBoundsScale=1,this.geometryType=Q.LW.TEXT,this._aux=(0,J.Jz)(0,0,this._referenceSize,this._bitset)}bindTextInfo(g,S){this._shapingInfo=g&&g.length?(0,Y.yw)(g,a=>(0,k.Nr)(a,S,{scale:this._scale,angle:this._angle,xOffset:this._xOffset,yOffset:this._yOffset,hAlign:this._xAlignD,vAlign:this._yAlignD,maxLineWidth:Math.max(32,Math.min(this._lineWidth,512)),lineHeight:R.xm*Math.max(.25,Math.min(this._lineHeight,4)),decoration:this._decoration,isCIM:this._isCIM})):null}_write(g,S,a,y){const Z=S.getDisplayId();this._writeGeometry(g,S,Z,a,y)}_writeGeometry(g,S,a,y,Z){const $=this._shapingInfo;if((0,Y.Wi)($))return;if((0,Y.pC)(this._textPlacement)){const D=null!=Z?Z:S.readLegacyGeometryForDisplay();return this._writePlacedText(g,a,D,$,y)}const q=Z?(0,ct.oB)((0,ct.GH)(Z),2):"esriGeometryPolygon"===S.geometryType?S.readCentroid():S.readGeometryForDisplay();if(!(0,Y.Wi)(q)){if(q.isPoint){const[D,B]=q.coords;return!g.hasAggregates&&g.hasPixelBufferEnabled&&(D<0||D>=512||B<0||B>=512)?void 0:this._writeGlyphs(g,a,{x:D,y:B},$)}q.forEachVertex((D,B)=>this._writeGlyphs(g,a,{x:D,y:B},$))}}_writePlacedText(g,S,a,y,Z){const $=(0,Y.Wg)(this._textPlacement),q=F.i.getPlacement(a,$,(0,ot.F2)(1),Z.geometryEngine);if(!q)return;let D=q.next();for(;null!=D;){const B=-D.getAngle();y.setRotation(B);const x=D.tx,W=-D.ty;x<0||x>=512||W<0||W>=512||(this._writeGlyphs(g,S,{x,y:W},y),y.setRotation(-B)),D=q.next()}}_writeGlyphs(g,S,a,y){const Z=U.m2.load(this._materialKey),$=(0,J.UJ)(Math.round(8*a.x),Math.round(8*a.y)),q=this._vertexBoundsScale,D=y.bounds,B=2*Math.max(D.width,D.height);for(const x of y.glyphs)Z.textureBinding=x.textureBinding,g.recordStart(S,Z.data,this.geometryType,!0),g.vertexBounds(a.x+D.x+this._xOffset,a.y+D.y-this._yOffset,B*q,B*q),this._writeVertices(g,S,$,x),g.recordEnd()}_writeGlyph(g,S,a,y,Z){const $=U.m2.load(this._materialKey),q=(0,J.UJ)(Math.round(8*a),Math.round(8*y));$.textureBinding=Z.textureBinding,g.recordStart(S,$.data,this.geometryType,!0);const D=Z.bounds,B=this._vertexBoundsScale;g.vertexBounds(a+D.x*B,y+D.y*B,D.width*B,D.height*B),this._writeVertices(g,S,q,Z),g.recordEnd()}_writeVertices(g,S,a,y){const Z=g.vertexCount();this._writeVertexCommon(g,S,a,y),g.vertexWrite(y.offsets.upperLeft),g.vertexWrite(y.texcoords.upperLeft),g.vertexEnd(),this._writeVertexCommon(g,S,a,y),g.vertexWrite(y.offsets.upperRight),g.vertexWrite(y.texcoords.upperRight),g.vertexEnd(),this._writeVertexCommon(g,S,a,y),g.vertexWrite(y.offsets.lowerLeft),g.vertexWrite(y.texcoords.lowerLeft),g.vertexEnd(),this._writeVertexCommon(g,S,a,y),g.vertexWrite(y.offsets.lowerRight),g.vertexWrite(y.texcoords.lowerRight),g.vertexEnd(),g.indexWrite(Z+0),g.indexWrite(Z+1),g.indexWrite(Z+2),g.indexWrite(Z+1),g.indexWrite(Z+3),g.indexWrite(Z+2)}_writeVertexCommon(g,S,a,y){const Z=this._color,$=this._haloColor,q=(0,J.Jz)(0,0,this._referenceSize,this._bitset),D=(0,J.Jz)(0,0,this._size,this._haloSize);g.vertexWrite(a),g.vertexWrite(S),g.vertexWrite(Z),g.vertexWrite($),g.vertexWrite(D),g.vertexWrite(q),g.vertexWrite(this._minMaxZoom)}}},18752:(Et,dt,d)=>{d.d(dt,{Z:()=>g});var Y=d(62208),ot=d(23841),ct=d(12225),F=d(9545),R=d(7547),Q=d(81295),J=d(39351),U=d(5254),k=d(18716),H=d(50114),V=d(88337),Tt=d(94358);class g extends((0,V.Z)(Tt.Z)){constructor(a,y,Z,$,q,D,B,x,W,A,rt,st,j,lt,ut,vt,xt,T,N,nt,K,at,mt){super(),this.angle=$,this.height=B,this.width=D,this.xOffset=y*N,this.yOffset=Z*N,this._markerPlacement=nt,this._effects=K,this._anchorX=.5-(.5+vt)*ut.width/ut.width,this._anchorY=.5-(.5+xt)*ut.height/ut.height,this._minMaxZoom=(0,U.UJ)(Math.round(at*J.MI),Math.round(mt*J.MI));const Lt=(lt===R.v2.MAP?J.Tz:J.CQ)|(rt?J.Uh:0)|(j?J.oK:0)|(st?J.e0:0),gt=ut&&ut.sdf,ft=k.mE.load(a);ft.sdf=gt,ft.pattern=!0,ft.textureBinding=ut.textureBinding,this._materialKey=ft.data,this._fillColor=q,this._outlineColor=W,this._sizeOutlineWidth=(0,U.Jz)(Math.round(Math.min(Math.sqrt(128*D),255)),Math.round(Math.min(Math.sqrt(128*B),255)),Math.round(Math.min(Math.sqrt(128*A),255)),Math.round(Math.min(Math.sqrt(128*x),255)));const Ot=ut.rect.x+J.fL,St=ut.rect.y+J.fL,Kt=Ot+ut.width,Ft=St+ut.height;this._offsets.xUpperLeft=Ot,this._offsets.yUpperLeft=St,this._offsets.xUpperRight=Kt,this._offsets.yUpperRight=St,this._offsets.xBottomLeft=Ot,this._offsets.yBottomLeft=Ft,this._offsets.xBottomRight=Kt,this._offsets.yBottomRight=Ft,this._texUpperLeft=(0,U.UJ)(Ot,St),this._texUpperRight=(0,U.UJ)(Kt,St),this._texBottomLeft=(0,U.UJ)(Ot,Ft),this._texBottomRight=(0,U.UJ)(Kt,Ft),D*=T,B*=T,D*=N,B*=N;const Jt=Math.round(64*T);this._bitestAndDistRatio=(0,U.UJ)(Lt,Jt),this._computedWidth=D,this._computedHeight=B;const w=(0,F.c)(),h=(0,ct.c)();this._applyTransformation(h,w)}static fromCIMMarker(a,y,Z){const D=a.size,B=(y&&y.width||1)/(y&&y.height||1)*a.scaleX,x=a.scaleSymbolsProportionally&&a.frameHeight?D/a.frameHeight:1;let W=(0,Q.t2)(a.color);const A=(0,Q.t2)(a.outlineColor),rt=(0,ot.F2)(D),st=rt*B,j=(0,ot.F2)(a.offsetX||0),lt=(0,ot.F2)(a.offsetY||0),ut=(0,ot.F2)(a.outlineWidth||0)*x,vt=a.alignment||R.v2.SCREEN,xt=(0,ot.F2)(a.referenceSize),[T,N]=(0,H._f)(a.scaleInfo,Z);y.sdf||0!==W||(W=-1);let nt=a.rotation||0;a.rotateClockwise||(nt=-nt);let K=0,at=0;const mt=a.anchorPoint;mt&&(a.isAbsoluteAnchorPoint?D&&(K=-mt.x/(D*B),at=mt.y/D):(K=mt.x,at=mt.y));const Lt=new g(a.materialKey,j,lt,nt,W,st,rt,xt,A,ut,a.colorLocked,a.scaleSymbolsProportionally,!1,vt,y,K,at,a.sizeRatio,(0,Y.Pt)(a.scaleFactor,1),a.markerPlacement,a.effects,T,N);return Lt._vertexBoundsScaleX=a.maxVVSize?a.maxVVSize/st:1,Lt._vertexBoundsScaleY=a.maxVVSize?a.maxVVSize/rt:1,Lt}static fromPictureMarker(a,y){const Z=Math.round((0,ot.F2)(a.width)),$=Math.round((0,ot.F2)(a.height)),q=J.ru,D=Math.round((0,ot.F2)(a.xoffset||0)),B=Math.round((0,ot.F2)(a.yoffset||0)),x=new g(a.materialKey,D,B,a.angle,q,Z,$,$,0,0,!1,!1,!1,R.v2.SCREEN,y,0,0,1,1,null,null,H.Xe,H.eW);return x._vertexBoundsScaleX=a.maxVVSize?a.maxVVSize/a.width:1,x._vertexBoundsScaleY=a.maxVVSize?a.maxVVSize/a.height:1,x}static fromSimpleMarker(a,y){const Z=(0,Q.aH)(a.color),$=Math.round((0,ot.F2)(a.size)),q=$,D=Math.round((0,ot.F2)(a.xoffset||0)),B=Math.round((0,ot.F2)(a.yoffset||0)),x=a.style,W=a.outline,A=0|(W&&W.color&&(0,Q.aH)(W.color)),rt=0|(W&&W.width&&Math.round((0,ot.F2)(W.width))),st=new g(a.materialKey,D,B,a.angle,Z,$,q,q,A,rt,!1,!1,"esriSMSCross"===x||"esriSMSX"===x,R.v2.SCREEN,y,0,0,126/64,1,null,null,H.Xe,H.eW);return st.boundsType="esriSMSCircle"===x?"circle":"square",st._vertexBoundsScaleX=a.maxVVSize?a.maxVVSize/a.size:1,st._vertexBoundsScaleY=a.maxVVSize?a.maxVVSize/a.size:1,st}static fromLineSymbolMarker(a,y){const Z=(0,Q.aH)(a.color),q=Math.round((0,ot.F2)(6*a.lineWidth)),D=q,B="cross"===a.style||"x"===a.style;let x;switch(a.placement){case"begin-end":x=R.Tx.Both;break;case"begin":x=R.Tx.JustBegin;break;case"end":x=R.Tx.JustEnd;break;default:x=R.Tx.None}const W={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:x,offsetAlongLine:0},A=new g(a.materialKey,0,0,0,Z,q,D,D/6,Z,B?Math.round((0,ot.F2)(a.lineWidth)):0,!1,!1,B,R.v2.MAP,y,0,0,126/64,1,W,null,H.Xe,H.eW);return A.boundsType="circle"===a.style?"circle":"square",A}}},94358:(Et,dt,d)=>{d.d(dt,{Z:()=>ct});var Y=d(62208),ot=d(73608);class ct{bindFeature(R,Q,J){}write(R,Q,J,U){var k;if((0,Y.Wi)(this._effects)||0===(null==(k=this._effects)?void 0:k.length))return this._write(R,Q,U);const H=ot.j.executeEffects(this._effects,Q.readLegacyGeometryForDisplay(),U.geometryEngine);let V=ot.j.next(H);for(;V;)this._write(R,Q,U,V),V=ot.j.next(H)}_write(R,Q,J,U){}}},1825:(Et,dt,d)=>{d.d(dt,{Wr:()=>Ne,Sl:()=>We});var Y=d(15861),ot=d(26584),ct=d(63290),F=d(10699),R=d(24837),Q=d(39406),J=d(18716),U=d(62208),k=d(23841),H=d(81295),V=d(39351),Tt=d(43289),g=d(5254),S=d(50114),a=d(82054),Z=(d(11915),d(58774)),$=d(88071),q=d(97938),D=d(47018);function B(l,i,r,n,s,c,u){O=0;const f=(n-r)*c,_=s&&s.length,M=_?(s[0]-r)*c:f;let v,E,C,P,L,z=x(i,r,0,0,M,c,!0);if(z&&z.next!==z.prev){if(_&&(z=function vt(l,i,r,n,s,c){const u=new Array;for(let f=0,_=n.length;f<_;f++){const M=x(l,i,0,n[f]*c,f<_-1?n[f+1]*c:r*c,c,!1);M===M.next&&(M.steiner=!0),u.push(ut(M))}u.sort(Kt);for(const f of u)xt(f,s),s=W(s,s.next);return s}(i,r,n,s,z,c)),f>80*c){v=C=i[0+r*c],E=P=i[1+r*c];for(let et=c;et<M;et+=c){const it=i[et+r*c],yt=i[et+1+r*c];v=Math.min(v,it),E=Math.min(E,yt),C=Math.max(C,it),P=Math.max(P,yt)}L=Math.max(C-v,P-E),L=0!==L?1/L:0}A(z,l,c,v,E,L,u,0)}}function x(l,i,r,n,s,c,u){let f;if(u===function Lt(l,i,r,n,s,c){let u=0;for(let f=n,_=s-c;f<s;f+=c)u+=(l[_+i*c]-l[f+i*c])*(l[f+1+i*c]+l[_+1+i*c]),_=f;return u}(l,i,0,n,s,c)>0)for(let _=n;_<s;_+=c)f=j(_+i*c,l[_+i*c],l[_+1+i*c],f);else for(let _=s-c;_>=n;_-=c)f=j(_+i*c,l[_+i*c],l[_+1+i*c],f);return f&&St(f,f.next)&&(lt(f),f=f.next),f}function W(l,i=l){if(!l)return l;let r,n=l;do{if(r=!1,n.steiner||!St(n,n.next)&&0!==K(n.prev,n,n.next))n=n.next;else{if(lt(n),n=i=n.prev,n===n.next)break;r=!0}}while(r||n!==i);return i}function A(l,i,r,n,s,c,u,f){if(!l)return;!f&&c&&(l=N(l,n,s,c));let _=l;for(;l.prev!==l.next;){const M=l.prev,v=l.next;if(c?st(l,n,s,c):rt(l))i.push(M.index/r+u),i.push(l.index/r+u),i.push(v.index/r+u),lt(l),l=v.next,_=v.next;else if((l=v)===_){f?1===f?A(l=Ft(l,i,r,u),i,r,n,s,c,u,2):2===f&&Jt(l,i,r,n,s,c,u):A(W(l),i,r,n,s,c,u,1);break}}}function rt(l){const i=l.prev,r=l,n=l.next;if(K(i,r,n)>=0)return!1;let s=l.next.next;const c=s;let u=0;for(;s!==l.prev&&(0===u||s!==c);){if(u++,gt(i.x,i.y,r.x,r.y,n.x,n.y,s.x,s.y)&&K(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function st(l,i,r,n){const s=l.prev,c=l,u=l.next;if(K(s,c,u)>=0)return!1;const M=s.x>c.x?s.x>u.x?s.x:u.x:c.x>u.x?c.x:u.x,v=s.y>c.y?s.y>u.y?s.y:u.y:c.y>u.y?c.y:u.y,E=Ot(s.x<c.x?s.x<u.x?s.x:u.x:c.x<u.x?c.x:u.x,s.y<c.y?s.y<u.y?s.y:u.y:c.y<u.y?c.y:u.y,i,r,n),C=Ot(M,v,i,r,n);let P=l.prevZ,L=l.nextZ;for(;P&&P.z>=E&&L&&L.z<=C;){if(P!==l.prev&&P!==l.next&&gt(s.x,s.y,c.x,c.y,u.x,u.y,P.x,P.y)&&K(P.prev,P,P.next)>=0||(P=P.prevZ,L!==l.prev&&L!==l.next&&gt(s.x,s.y,c.x,c.y,u.x,u.y,L.x,L.y)&&K(L.prev,L,L.next)>=0))return!1;L=L.nextZ}for(;P&&P.z>=E;){if(P!==l.prev&&P!==l.next&&gt(s.x,s.y,c.x,c.y,u.x,u.y,P.x,P.y)&&K(P.prev,P,P.next)>=0)return!1;P=P.prevZ}for(;L&&L.z<=C;){if(L!==l.prev&&L!==l.next&&gt(s.x,s.y,c.x,c.y,u.x,u.y,L.x,L.y)&&K(L.prev,L,L.next)>=0)return!1;L=L.nextZ}return!0}function j(l,i,r,n){const s=p.create(l,i,r);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function lt(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function ut(l){let i=l,r=l;do{(i.x<r.x||i.x===r.x&&i.y<r.y)&&(r=i),i=i.next}while(i!==l);return r}function xt(l,i){if(i=function T(l,i){let r=i;const n=l.x,s=l.y;let c,u=-1/0;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){const C=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(C<=n&&C>u){if(u=C,C===n){if(s===r.y)return r;if(s===r.next.y)return r.next}c=r.x<r.next.x?r:r.next}}r=r.next}while(r!==i);if(!c)return null;if(n===u)return c.prev;const f=c,_=c.x,M=c.y;let v,E=1/0;for(r=c.next;r!==f;)n>=r.x&&r.x>=_&&n!==r.x&&gt(s<M?n:u,s,_,M,s<M?u:n,s,r.x,r.y)&&(v=Math.abs(s-r.y)/(n-r.x),(v<E||v===E&&r.x>c.x)&&ft(r,l)&&(c=r,E=v)),r=r.next;return c}(l,i)){const r=m(i,l);W(r,r.next)}}function N(l,i,r,n){for(let s;s!==l;s=s.next){if(s=s||l,null===s.z&&(s.z=Ot(s.x,s.y,i,r,n)),s.prev.next!==s||s.next.prev!==s)return s.prev.next=s,s.next.prev=s,N(l,i,r,n);s.prevZ=s.prev,s.nextZ=s.next}return l.prevZ.nextZ=null,l.prevZ=null,function nt(l){let i,r=1;for(;;){let n,s=l;l=null,i=null;let c=0;for(;s;){c++,n=s;let u=0;for(;u<r&&n;u++)n=n.nextZ;let f=r;for(;u>0||f>0&&n;){let _;0===u?(_=n,n=n.nextZ,f--):0!==f&&n?s.z<=n.z?(_=s,s=s.nextZ,u--):(_=n,n=n.nextZ,f--):(_=s,s=s.nextZ,u--),i?i.nextZ=_:l=_,_.prevZ=i,i=_}s=n}if(i.nextZ=null,r*=2,c<2)return l}}(l)}function K(l,i,r){return(i.y-l.y)*(r.x-i.x)-(i.x-l.x)*(r.y-i.y)}function at(l,i,r,n){return!!(St(l,i)&&St(r,n)||St(l,n)&&St(r,i))||K(l,i,r)>0!=K(l,i,n)>0&&K(r,n,l)>0!=K(r,n,i)>0}function gt(l,i,r,n,s,c,u,f){return(s-u)*(i-f)-(l-u)*(c-f)>=0&&(l-u)*(n-f)-(r-u)*(i-f)>=0&&(r-u)*(c-f)-(s-u)*(n-f)>=0}function ft(l,i){return K(l.prev,l,l.next)<0?K(l,i,l.next)>=0&&K(l,l.prev,i)>=0:K(l,i,l.prev)<0||K(l,l.next,i)<0}function Ot(l,i,r,n,s){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=32767*(l-r)*s)|l<<8))|l<<4))|l<<2))|l<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-n)*s)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function St(l,i){return l.x===i.x&&l.y===i.y}function Kt(l,i){return l.x-i.x}function Ft(l,i,r,n){let s=l;do{const c=s.prev,u=s.next.next;!St(c,u)&&at(c,s,s.next,u)&&ft(c,u)&&ft(u,c)&&(i.push(c.index/r+n),i.push(s.index/r+n),i.push(u.index/r+n),lt(s),lt(s.next),s=l=u),s=s.next}while(s!==l);return s}function Jt(l,i,r,n,s,c,u){let f=l;do{let _=f.next.next;for(;_!==f.prev;){if(f.index!==_.index&&w(f,_)){let M=m(f,_);return f=W(f,f.next),M=W(M,M.next),A(f,i,r,n,s,c,u,0),void A(M,i,r,n,s,c,u,0)}_=_.next}f=f.next}while(f!==l)}function w(l,i){return l.next.index!==i.index&&l.prev.index!==i.index&&!function mt(l,i){let r=l;do{if(r.index!==l.index&&r.next.index!==l.index&&r.index!==i.index&&r.next.index!==i.index&&at(r,r.next,l,i))return!0;r=r.next}while(r!==l);return!1}(l,i)&&ft(l,i)&&ft(i,l)&&function h(l,i){let r=l,n=!1;const s=(l.x+i.x)/2,c=(l.y+i.y)/2;do{r.y>c!=r.next.y>c&&r.next.y!==r.y&&s<(r.next.x-r.x)*(c-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==l);return n}(l,i)}function m(l,i){const r=p.create(l.index,l.x,l.y),n=p.create(i.index,i.x,i.y),s=l.next,c=i.prev;return l.next=i,i.prev=l,r.next=s,s.prev=r,n.next=r,r.prev=n,c.next=n,n.prev=c,n}class p{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}static create(i,r,n){const s=O<I.length?I[O++]:new p;return s.index=i,s.x=r,s.y=n,s.prev=null,s.next=null,s.z=null,s.prevZ=null,s.nextZ=null,s.steiner=!1,s}}const I=new Array;let O=0;for(let l=0;l<8096;l++)I.push(new p);const tt=new D.b(0,0,0,1,0),ht=new D.b(0,0,0,1,0);function _t(l,i,r){let n=0;for(let s=1;s<r;s++)n+=(l[2*(i+s)]-l[2*(i+s-1)])*(l[2*(i+s)+1]+l[2*(i+s-1)+1]);return n}function G(l,i,r,n,s){let c=0;for(let f=r;f<n;f+=3){const _=2*(l[f]-s),M=2*(l[f+1]-s),v=2*(l[f+2]-s);c+=Math.abs((i[_]-i[v])*(i[M+1]-i[_+1])-(i[_]-i[M])*(i[v+1]-i[_+1]))}return c}tt.setExtent(V.I_),ht.setExtent(V.I_);var Bt=d(7547),At=d(64288),Gt=d(46519);const me=l=>class extends l{constructor(...i){super(...i),this.tessellationProperties={},this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0},this.geometryType=Q.LW.LINE}writeGeometry(i,r,n,s){this._writeGeometry(i,r,n,s)}_initializeTessellator(i){const r=J.a.load(this._materialKey),n=J.dk.load(this._materialKey),s=this._tessellationOptions,u=this.tessellationProperties._halfWidth<V.tQ&&!i&&!(r.vvSizeFieldStops||r.vvSizeMinMaxValue||r.vvSizeScaleStops||r.vvSizeUnitValue);this.tessellationProperties.minMaxZoom=this._minMaxZoom,s.wrapDistance=65535,s.textured=this._isDashed||this._hasPattern,s.offset=this.tessellationProperties.offset,s.halfWidth=this.tessellationProperties._halfWidth;const f=u?0:1;this._lineTessellator=new Gt.z((n.outlinedFill?Ce:Se)(this.tessellationProperties,f,f),ze(this.tessellationProperties),u)}_write(i,r,n,s){const c="esriGeometryPoint"===r.geometryType;i.recordStart(r.getDisplayId(),this._materialKey,this.geometryType,c),this._writeGeometry(i,r,s,c),i.recordEnd()}_writeGeometry(i,r,n,s){const c=null!=n?n:r.readLegacyGeometryForDisplay(),u=this._getLines(c,s);(0,U.Wi)(u)||this._writeVertices(i,r,u)}_getLines(i,r){if((0,U.Wi)(i))return null;const n=i.paths||i.rings;return(0,U.Wi)(n)?null:function It(l,i){ht.setPixelMargin(i);const r=ht,n=-i,s=V.I_+i;let c=[],u=!1,f=0;for(;f<l.length;){const _=[],M=l[f];if(!M)return null;r.reset(q.V.LineString);let[v,E]=M[0];if(u)r.moveTo(v,E);else{if(v<n||v>s||E<n||E>s){u=!0;continue}_.push({x:v,y:E})}let C=!1;const P=M.length;for(let L=1;L<P;++L)if(v+=M[L][0],E+=M[L][1],u)r.lineTo(v,E);else{if(v<n||v>s||E<n||E>s){C=!0;break}_.push({x:v,y:E})}if(C)u=!0;else{if(u){const L=r.resultWithStarts();if(L)for(const z of L)c.push(z)}else c.push({line:_,start:0});f++,u=!1}}return c=c.filter(_=>_.line.length>1),0===c.length?null:c}(n,r?256:16)}_writeVertices(i,r,n){const s=r.getDisplayId(),c=i.vertexCount(),u=this.tessellationProperties,f=this._tessellationOptions;u.out=i,u.id=s,u.indexCount=0,u.vertexCount=0,u.offset=c,f.capType=this._capType,f.joinType=this._joinType;const _=J.dk.load(this._materialKey);this.tessellationProperties.key=_.outlinedFill?_:J.a.load(this._materialKey);for(const{line:M,start:v}of n)f.initialDistance=v%65535,this._lineTessellator.tessellate(M,f)}},Se=(l,i,r)=>(n,s,c,u,f,_,M,v,E,C,P)=>{const L=(0,g.UJ)(P,Math.ceil(16*l._halfWidth)),z=(0,g.Jz)(Math.round(16*M),Math.round(16*v),Math.round(16*E),Math.round(16*C)),et=(0,g.Jz)(16*f,16*_,0,l._bitset),it=l.out;return it.vertexBounds(n,s,i,r),it.vertexWrite((0,g.UJ)(8*n,8*s)),it.vertexWrite(l.id),it.vertexWrite(l._fillColor),it.vertexWrite(z),it.vertexWrite(L),it.vertexWrite(l._tl),it.vertexWrite(l._br),it.vertexWrite(et),it.vertexWrite((0,g.UJ)(Math.ceil(16*l._halfReferenceWidth),0)),it.vertexWrite(l.minMaxZoom),it.vertexEnd(),l.offset+l.vertexCount++},Ce=(l,i,r)=>(n,s,c,u,f,_,M,v,E,C,P)=>{const L=(0,g.Jz)(0,0,16*l._halfWidth,16*l._halfReferenceWidth),z=(0,g.Jz)(16*M+128,16*v+128,16*E+128,16*C+128),et=l.out,it=l._bitset<<24|l.id;return et.vertexBounds(n,s,i,r),et.vertexWrite((0,g.UJ)(8*n,8*s)),et.vertexWrite(it),et.vertexWrite(l._fillColor),l.key.simple||(et.vertexWrite(0),et.vertexWrite(0)),et.vertexWrite(L),et.vertexWrite(z),l.key.simple||et.vertexWrite(l.minMaxZoom),et.vertexEnd(),l.offset+l.vertexCount++},ze=l=>(i,r,n)=>{const s=l.out;s.indexWrite(i),s.indexWrite(r),s.indexWrite(n),l.indexCount+=3};var ae=d(94358);const be=ct.Z.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate");class kt extends(me(ae.Z)){constructor(i,r,n,s,c,u,f,_,M,v,E,C,P,L,z,et,it,yt,Dt){super();const Ct=J.a.load(i);r&&(Ct.sdf=r.sdf,Ct.pattern=!0,Ct.textureBinding=r.textureBinding),this._capType=s,this._joinType=c,this._miterLimitCosine=(0,S.NW)(u),this.tessellationProperties._fillColor=f,this.tessellationProperties._tl=_,this.tessellationProperties._br=M,this._hasPattern=v,this._isDashed=E,this._zOrder=et,this._effects=it,this._minMaxZoom=(0,g.UJ)(Math.round(yt*V.MI),Math.round(Dt*V.MI)),this._materialKey=Ct.data,this.tessellationProperties._bitset=(P?V.Uh:0)|(L?V.SD:0)|(C?V._6:0),this.tessellationProperties._halfWidth=.5*n,this.tessellationProperties._halfReferenceWidth=.5*z,this.tessellationProperties.offset=0,this._initializeTessellator(!1)}static fromCIMLine(i,r,n){const s=i.color,c=i.scaleFactor||1,u=!!i.dashTemplate;let f=i.cap;u&&f===Bt.RL.ROUND&&(f=Bt.RL.SQUARE);const _=i.join,M=(0,k.F2)(i.width)*c,v=(0,k.F2)(i.referenceWidth),E=(0,k.F2)(i.miterLimit),C=s&&(0,H.t2)(s)||0,[P,L]=(0,S._f)(i.scaleInfo,n);if(!r)return new kt(i.materialKey,r,M,f,_,E,C,0,0,!1,u,i.scaleDash,i.colorLocked,!1,v,i.zOrder,i.effects,P,L);const{rect:et,width:it,height:yt}=r,Dt=et.x+V.fL,Ct=et.y+V.fL,Zt=Dt+it,Yt=Ct+yt,Qt=(0,g.UJ)(Dt,Ct),$t=(0,g.UJ)(Zt,Yt);return new kt(i.materialKey,r,M,f,_,E,C,Qt,$t,!0,u,i.scaleDash,i.colorLocked,!1,v,i.zOrder,i.effects,P,L)}static fromFillOutline(i){var r;return i.isOutlinedFill&&i.outline&&"esriSLSSolid"===(null==(r=i.outline)?void 0:r.style)?kt.fromSimpleLine(qt({hash:"",materialKey:i.materialKey},i.outline),null,!0):null}static fromSimpleLine(i,r,n=!1){const{color:s}=i,c="esriSLSSolid"!==i.style&&"esriSLSNull"!==i.style,u=(0,At.ws)(i.cap||"round"),f=(0,At.xV)(i.join||"round");let _=s&&"esriSLSNull"!==i.style&&(0,H.aH)(s)||0;"esriSLSNull"===i.style&&(_=0);const M=(0,k.F2)(i.width),v=i.miterLimit;if(!r)return new kt(i.materialKey,r,M,u,f,v,_,0,0,!1,c,!0,!1,n,M,0,null,S.Xe,S.eW);const{rect:E,width:C,height:P}=r,L=E.x+V.fL,z=E.y+V.fL,et=L+C,it=z+P,yt=(0,g.UJ)(L,z),Dt=(0,g.UJ)(et,it);return new kt(i.materialKey,r,M,u,f,v,_,yt,Dt,!0,c,!0,!1,n,M,0,null,S.Xe,S.eW)}static fromPictureLineSymbol(i,r,n,s){return be.error("PictureLineSymbol support does not exist!"),null}}const xe=l=>class extends l{constructor(...i){super(...i),this.forceLibtess=!1,this._bitset=0,this._lineTemplate=null,this.geometryType=Q.LW.FILL}_maybeAddLineTemplate(i){this._lineTemplate=kt.fromFillOutline(i)}_write(i,r,n,s){const c="esriGeometryPoint"===r.geometryType,u=J.dk.load(this._materialKey);i.recordStart(r.getDisplayId(),this._materialKey,this.geometryType,c),this._writeGeometry(i,r,u,s,c),u.outlinedFill&&(0,U.pC)(this._lineTemplate)&&this._lineTemplate.writeGeometry(i,r,s,c),i.recordEnd()}_writeGeometry(i,r,n,s,c){const u=this._getGeometry(r,s,c);if((0,U.Wi)(u))return;const f=[];if(!(u.maxLength>100)&&!this.forceLibtess&&function Pt(l,i){const{coords:r,lengths:n,hasIndeterminateRingOrder:s}=i,u=l;if(s)return!1;let f=0;for(let _=0;_<n.length;){let M=_,v=n[_],E=_t(r,f,v);const C=[];for(;++M<n.length;){const et=n[M],it=_t(r,f+v,et);if(!(it>0))break;E+=it,C.push(f+v),v+=et}const P=u.length;B(u,r,f,f+v,C,2,0);const L=G(u,r,P,u.length,0),z=Math.abs(E);if(Math.abs((L-z)/Math.max(1e-7,z))>1e-5)return u.length=0,!1;_=M,f+=v}return!0}(f,u))return void(f.length&&this._writeVertices(i,r,u.coords,u.lengths,n,f));const _=function pt(l){const{coords:i,lengths:r}=l,{buffer:n}=(0,Z.b)(i,r);return n}(u);this._writeVertices(i,r,_,[_.length/2],n)}_writeVertex(i,r,n,s,c,u){const f=(0,g.UJ)(1*s,1*c);i.vertexBounds(s,c,0,0),i.vertexWrite(f),i.vertexWrite(r),n.dotDensity?i.vertexWriteF32(1/Math.abs(u.readGeometryArea())):(i.vertexWrite(this.fillColor),n.simple||(i.vertexWrite(this.tl),i.vertexWrite(this.br)),i.vertexWrite(this.aux2),i.vertexWrite(this.aux3),n.simple||i.vertexWrite(this._minMaxZoom))}_writeVertices(i,r,n,s,c,u){const f=r.getDisplayId(),_=this._bitset<<24|f,M=s.reduce((P,L)=>P+L),v=c.dotDensity?4:10,E=i.vertexCount();i.vertexEnsureSize(v*M);let C=0;if(u)for(const P of u)this._writeVertex(i,_,c,n[2*P],n[2*P+1],r),C++;else for(let P=0;P<n.length;P+=2){const L=Math.round(n[P]),z=Math.round(n[P+1]);this._writeVertex(i,_,c,L,z,r),C++}i.indexEnsureSize(C);for(let P=0;P<C;P++)i.indexWrite(P+E)}_getGeometry(i,r,n){const s=r?(0,a.oB)((0,a.GH)(r),2):i.readGeometryForDisplay();return s?function Wt(l,i){if((0,U.Wi)(l))return null;if(!function zt(l,i,r){let n=0;for(let s=0;s<l.lengths.length;s++){const c=l.lengths[s];for(let u=0;u<c;u++){const f=l.coords[2*(u+n)],_=l.coords[2*(u+n)+1];if(f<i||f>r||_<i||_>r)return!0}n+=c}return!1}(l,-128,V.I_+128))return l;tt.setPixelMargin(i),tt.reset(q.V.Polygon);let r=0;for(let u=0;u<l.lengths.length;u++){const f=l.lengths[u];let _=l.coords[2*(0+r)],M=l.coords[2*(0+r)+1];tt.moveTo(_,M);for(let v=1;v<f;v++)_=l.coords[2*(v+r)],M=l.coords[2*(v+r)+1],tt.lineTo(_,M);tt.close(),r+=f}const n=tt.result(!1);if(!n)return null;const s=[],c=[];for(const u of n){let f=0;for(const _ of u)c.push(_.x),c.push(_.y),f++;s.push(f)}return new $.Z(s,c)}(s,n?256:8):null}};var De=d(84175),le=d(80991);const ye=ct.Z.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate");class ee extends ae.Z{constructor(i){super(),this._ongoingMaterialRequestMap=new Map,this._materialCache=new Map,this._dynamicPropertyMap=new Map,this._cimLayer=i}analyze(i,r,n,s,c){if(c&&0===c.length)return null;const u=c&&c.length>0,f=r.readLegacyFeature(),_=this._materialCache,M=this._cimLayer.materialHash;if(!M)return ye.error("A Dynamic mesh template must have a material hash value or function!"),Promise.reject(null);const v="function"==typeof M?M(f,n,s):M;if(_.has(v)){const yt=_.get(v);return Promise.resolve(yt)}const E=this._ongoingMaterialRequestMap.get(v);if(E)return E;const C=this._cimLayer,P=(0,De.S)(C.cim,this._cimLayer.materialOverrides);P.mosaicHash=v;const{type:L,url:z}=C,et={cim:P,type:L,mosaicHash:v,url:z,size:null,dashTemplate:null,text:null,fontName:null};switch(L){case"marker":et.size=(0,le.hf)(C.size,f,n,s);break;case"line":et.dashTemplate=C.dashTemplate;break;case"text":et.text=(0,le.hf)(C.text,f,n,s),et.fontName=(0,le.hf)(C.fontName,f,n,s)}const it=i.getMosaicItem(et,c).then(yt=>(u||(this._ongoingMaterialRequestMap.delete(v),_.set(v,yt)),yt)).catch(yt=>(this._ongoingMaterialRequestMap.delete(v),ye.error(".analyze()",yt.message),null));return u||this._ongoingMaterialRequestMap.set(v,it),it}}var Ut=d(84450);class he extends(xe(ee)){constructor(i,r,n){var s;if(super(i),this._minMaxZoom=(0,g.UJ)(Math.round(r*V.MI),Math.round(n*V.MI)),(0,S.mf)(i.color))this._dynamicPropertyMap.set("fillColor",(C,P,L)=>{const z=i.color(C,P,L);return z&&(0,H.t2)(z)||0});else{const E=i.color;this.fillColor=E&&(0,H.t2)(E)||0}const c="CIMMarkerPlacementInsidePolygon"===(null==(s=i.cim.placement)?void 0:s.type)&&i.cim.placement.shiftOddRows?2:1,u=i.height;(0,S.mf)(u)?this._dynamicPropertyMap.set("_height",(C,P,L)=>u(C,P,L)*c):this._height=(u||0)*c;const f=i.offsetX;if((0,S.mf)(f))this._dynamicPropertyMap.set("_offsetX",(C,P,L)=>{let z=(0,k.F2)(f(C,P,L))+128;return z>255?z=255:z<0&&(z=0),z});else{let E=(0,k.F2)(f||0)+128;E>255?E=255:E<0&&(E=0),this._offsetX=E}const _=i.offsetY;if((0,S.mf)(_))this._dynamicPropertyMap.set("_offsetY",(C,P,L)=>{let z=(0,k.F2)(-_(C,P,L))+128;return z>255?z=255:z<0&&(z=0),z});else{let E=(0,k.F2)(-_||0)+128;E>255?E=255:E<0&&(E=0),this._offsetY=E}const M=i.scaleX;(0,S.mf)(M)?this._dynamicPropertyMap.set("_scaleX",M):this._scaleX=M||1;const v=i.angle;if((0,S.mf)(v)?this._dynamicPropertyMap.set("_angle",(C,P,L)=>(0,Tt.Or)(v(C,P,L))):this._angle=(0,Tt.Or)(v)||0,(0,U.pC)(i.effects)){const E=i.effects;(0,S.mf)(E)?this._dynamicPropertyMap.set("_effects",E):this._effects=E}this._cimFillLayer=i,this._fillMaterialKey=J.dk.load(i.materialKey)}static fromCIMFill(i,r){const[n,s]=(0,S._f)(i.scaleInfo,r);return new he(i,n,s)}bindFeature(i,r,n){const s=i.readLegacyFeature();this._dynamicPropertyMap.forEach((v,E)=>{this[E]=v(s,r,n)});const c=this._fillMaterialKey,u=this._materialCache,f=(0,this._cimFillLayer.materialHash)(s,r,n),_=u.get(f);let M=null;if(_&&(0,Ut.ok)(_.spriteMosaicItem)&&(M=_.spriteMosaicItem),M){const{rect:v,width:E,height:C}=M,P=v.x+V.fL,L=v.y+V.fL,z=P+E,et=L+C;let it=Math.round((0,k.F2)(this._height));it>255?it=255:it<=0&&(it=et-L);let yt=Math.round((0,k.F2)(this._height/C*E||0));yt>255?yt=255:yt<=0&&(yt=z-P);const Dt=this._scaleX,Ct=1;this.tl=(0,g.UJ)(P,L),this.br=(0,g.UJ)(z,et),this.aux2=(0,g.Jz)(yt,it,this._offsetX,this._offsetY),this.aux3=(0,g.Jz)(Dt,Ct,this._angle,0),c.sdf=M.sdf,c.pattern=!0,c.textureBinding=M.textureBinding}else this.tl=0,this.br=0,this.aux2=0,this.aux3=0,c.sdf=!1,c.pattern=!1,c.textureBinding=0;this._materialKey=c.data}}class ce extends(me(ee)){constructor(i,r,n){super(i),this._minMaxZoom=(0,g.UJ)(Math.round(r*V.MI),Math.round(n*V.MI)),this._cimLineLayer=i;let s=0;(0,S.mf)(i.width)||(s=.5*(0,k.F2)(i.width)),this._dynamicPropertyMap.set("_halfWidth",(_,M,v)=>(0,S.mf)(i.width)?.5*(0,k.F2)(i.width(_,M,v)):s),(0,S.mf)(i.cap)?this._dynamicPropertyMap.set("_capType",i.cap):this._capType=i.cap,(0,S.mf)(i.join)?this._dynamicPropertyMap.set("_joinType",i.join):this._joinType=i.join;const u=i.color;(0,S.mf)(u)?this._dynamicPropertyMap.set("_fillColor",(M,v,E)=>(0,H.t2)(u(M,v,E))):this._fillColor=u&&(0,H.t2)(u)||0;const f=i.miterLimit;if((0,S.mf)(f)?this._dynamicPropertyMap.set("_miterLimitCosine",(M,v,E)=>(0,S.NW)(f(M,v,E))):this._miterLimitCosine=(0,S.NW)(f),(0,U.pC)(i.effects)){const _=i.effects;(0,S.mf)(_)?this._dynamicPropertyMap.set("_effects",_):this._effects=_}this._scaleFactor=i.scaleFactor||1,this._isDashed=null!=i.dashTemplate,this.tessellationProperties._bitset=(i.colorLocked?1:0)|(i.scaleDash?1:0)<<1,this._materialKey=i.materialKey,this._initializeTessellator(!0)}static fromCIMLine(i,r){const[n,s]=(0,S._f)(i.scaleInfo,r);return new ce(i,n,s)}bindFeature(i,r,n){const s=i.readLegacyFeature();this._dynamicPropertyMap.forEach((v,E)=>{this[E]=v(s,r,n)}),this._halfWidth*=this._scaleFactor;const c=this._materialCache,u=(0,this._cimLineLayer.materialHash)(s,r,n),f=c.get(u);let _=null;if(f&&(0,Ut.ok)(f.spriteMosaicItem)&&(_=f.spriteMosaicItem),_){this._hasPattern=!0;const{rect:v,width:E,height:C}=_,P=v.x+V.fL,L=v.y+V.fL,z=P+E,et=L+C;this.tessellationProperties._tl=(0,g.UJ)(P,L),this.tessellationProperties._br=(0,g.UJ)(z,et)}else this._hasPattern=!1,this.tessellationProperties._tl=0,this.tessellationProperties._br=0;this.tessellationProperties._fillColor=this._fillColor,this.tessellationProperties._halfWidth=this._halfWidth,this.tessellationProperties.offset=0,this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;const M=J.a.load(this._materialKey);_&&(M.sdf=_.sdf,M.pattern=!0,M.textureBinding=_.textureBinding),this._materialKey=M.data}}var Oe=d(12225),Be=d(9545),Fe=d(88337);const Re=(0,Be.c)(),Ae=(0,Oe.c)(),Ue=ct.Z.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate");class ue extends((0,Fe.Z)(ee)){constructor(i,r,n){super(i),this._cimMarkerLayer=i,this._minMaxZoom=(0,g.UJ)(Math.round(r*V.MI),Math.round(n*V.MI));const s=i.color;(0,S.mf)(s)?this._dynamicPropertyMap.set("_fillColor",(P,L,z)=>(0,H.t2)(s(P,L,z))):this._fillColor=(0,H.t2)(s);const c=i.outlineColor;(0,S.mf)(c)?this._dynamicPropertyMap.set("_outlineColor",(P,L,z)=>(0,H.t2)(c(P,L,z))):this._outlineColor=(0,H.t2)(c);const u=i.size;(0,S.mf)(u)?this._dynamicPropertyMap.set("_size",(P,L,z)=>(0,k.F2)(u(P,L,z))):this._size=(0,k.F2)(u)||0;const f=i.scaleX;(0,S.mf)(f)?this._dynamicPropertyMap.set("_scaleX",f):this._scaleX=f||1;const _=i.offsetX;(0,S.mf)(_)?this._dynamicPropertyMap.set("xOffset",(P,L,z)=>(0,k.F2)(_(P,L,z))):this.xOffset=(0,k.F2)(_)||0;const M=i.offsetY;(0,S.mf)(M)?this._dynamicPropertyMap.set("yOffset",(P,L,z)=>(0,k.F2)(M(P,L,z))):this.yOffset=(0,k.F2)(M)||0;const v=i.outlineWidth;(0,S.mf)(v)?this._dynamicPropertyMap.set("_outlineWidth",(P,L,z)=>(0,k.F2)(v(P,L,z))):this._outlineWidth=(0,k.F2)(v)||0;const E=i.rotation;if((0,S.mf)(E)?this._dynamicPropertyMap.set("_angle",E):this._angle=E||0,(0,U.pC)(i.effects)){const C=i.effects;(0,S.mf)(C)?this._dynamicPropertyMap.set("_effects",C):this._effects=C}if((0,U.pC)(i.markerPlacement)){const C=i.markerPlacement;(0,S.mf)(C)?this._dynamicPropertyMap.set("_markerPlacement",C):this._markerPlacement=C}this._scaleFactor=(0,U.Pt)(i.scaleFactor,1),this._bitSet=(i.alignment===Bt.v2.MAP?1:0)|(i.colorLocked?1:0)<<1|(i.scaleSymbolsProportionally?1:0)<<3,this._materialKey=i.materialKey}static fromCIMMarker(i,r){const[n,s]=(0,S._f)(i.scaleInfo,r);return new ue(i,n,s)}bindFeature(i,r,n){const s=i.readLegacyFeature();this._dynamicPropertyMap.forEach((Ye,Qe)=>{this[Qe]=Ye(s,r,n)});const c=this._cimMarkerLayer.materialHash,u="function"==typeof c?c(s,r,n):c,f=this._materialCache.get(u);if(!f||!(0,Ut.ok)(f.spriteMosaicItem)||!f.spriteMosaicItem)return void Ue.error(new ot.Z("mapview-cim","Encountered an error when binding feature"));const _=f.spriteMosaicItem,M=this._cimMarkerLayer.sizeRatio,v=_.width/_.height*this._scaleX,E=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle;let C=this._size,P=C*v;const L=this.xOffset,z=this.yOffset;this.xOffset*=this._scaleFactor,this.yOffset*=this._scaleFactor;const et=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/(0,k.F2)(this._cimMarkerLayer.frameHeight):1,it=this._outlineWidth*et,yt=(0,k.F2)(this._cimMarkerLayer.referenceSize);let Dt=0,Ct=0;const Zt=this._cimMarkerLayer.anchorPoint;Zt&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(Dt=-Zt.x/(this._size*v),Ct=Zt.y/this._size):(Dt=Zt.x,Ct=Zt.y)),this._sizeOutlineWidth=(0,g.Jz)(Math.round(Math.min(Math.sqrt(128*P),255)),Math.round(Math.min(Math.sqrt(128*C),255)),Math.round(Math.min(Math.sqrt(128*it),255)),Math.round(Math.min(Math.sqrt(128*yt),255))),this.angle=E;const Yt=Math.round(64*M);this._bitestAndDistRatio=(0,g.UJ)(this._bitSet,Yt);const Qt=_.rect.x+V.fL,$t=_.rect.y+V.fL,ne=Qt+_.width,Ee=$t+_.height;this._texUpperLeft=(0,g.UJ)(Qt,$t),this._texUpperRight=(0,g.UJ)(ne,$t),this._texBottomLeft=(0,g.UJ)(Qt,Ee),this._texBottomRight=(0,g.UJ)(ne,Ee);const oe=J.mE.load(this._materialKey);oe.sdf=_.sdf,oe.pattern=!0,oe.textureBinding=_.textureBinding,this._materialKey=oe.data,this._anchorX=.5-(.5+Dt)*_.width/_.width,this._anchorY=.5-(.5+Ct)*_.height/_.height,P*=M,C*=M,P*=this._scaleFactor,C*=this._scaleFactor,P*=_.rect.width/_.width,C*=_.rect.height/_.height,this._computedWidth=P,this._computedHeight=C,this._applyTransformation(Ae,Re),this.xOffset=L,this.yOffset=z}}var ge=d(61261),Ze=d(44526),Me=d(32954);class fe extends((0,Ze.Z)(ee)){constructor(i,r,n){super(i),this._horizontalAlignment="center",this._verticalAlignment="middle",this._textToGlyphs=new Map,this._minMaxZoom=(0,g.UJ)(Math.round(r*V.MI),Math.round(n*V.MI));const s=i.scaleFactor||1;this._cimTextLayer=i;const c=i.color;(0,S.mf)(c)?this._dynamicPropertyMap.set("_color",(et,it,yt)=>(0,H.t2)(c(et,it,yt))):this._color=(0,H.t2)(c);const u=i.outlineColor;let f,M,E;if((0,S.mf)(u)?this._dynamicPropertyMap.set("_haloColor",(et,it,yt)=>(0,H.t2)(u(et,it,yt))):this._haloColor=(0,H.t2)(u),(0,S.mf)(i.size)||(f=Math.min(Math.round((0,k.F2)(i.size*i.sizeRatio)),127)),this._dynamicPropertyMap.set("_size",(z,et,it)=>(0,S.mf)(i.size)?Math.min(Math.round((0,k.F2)(i.size(z,et,it)*i.sizeRatio)),127):f),(0,S.mf)(i.outlineSize)?this._dynamicPropertyMap.set("_haloSize",(et,it,yt)=>Math.min(Math.floor(5*(0,k.F2)(i.outlineSize(et,it,yt)*i.sizeRatio)),127)):this._haloSize=Math.min(Math.floor(5*(0,k.F2)(i.outlineSize*i.sizeRatio)),127),(0,S.mf)(i.offsetX)||(M=Math.round((0,k.F2)(i.offsetX*i.sizeRatio))),this._dynamicPropertyMap.set("_xOffset",(z,et,it)=>(0,S.mf)(i.offsetX)?Math.round((0,k.F2)(i.offsetX(z,et,it)*i.sizeRatio)):M),(0,S.mf)(i.offsetY)||(E=Math.round((0,k.F2)(i.offsetY*i.sizeRatio))),this._dynamicPropertyMap.set("_yOffset",(z,et,it)=>(0,S.mf)(i.offsetY)?Math.round((0,k.F2)(i.offsetY(z,et,it)*i.sizeRatio)):E),(0,S.mf)(i.angle)?this._dynamicPropertyMap.set("_angle",i.angle):this._angle=i.angle,(0,S.mf)(i.horizontalAlignment)?this._dynamicPropertyMap.set("_horizontalAlignment",i.horizontalAlignment):this._horizontalAlignment=i.horizontalAlignment,(0,S.mf)(i.verticalAlignment)?this._dynamicPropertyMap.set("_verticalAlignment",i.verticalAlignment):this._verticalAlignment=i.verticalAlignment,(0,U.pC)(i.effects)){const z=i.effects;(0,S.mf)(z)?this._dynamicPropertyMap.set("_effects",z):this._effects=z}if((0,U.pC)(i.markerPlacement)){const z=i.markerPlacement;(0,S.mf)(z)?this._dynamicPropertyMap.set("_markerPlacement",z):this._textPlacement=z}(0,S.mf)(i.text)?this._dynamicPropertyMap.set("_text",i.text):this._text=i.text,this._scaleFactor=s;const P=Math.min(Math.round((0,k.F2)(i.referenceSize*i.sizeRatio)),127);this._referenceSize=Math.round(Math.sqrt(256*P)),this._materialKey=i.materialKey;const L=J.qr.load(this._materialKey);L.sdf=!0,this._bitset=(i.alignment===Bt.v2.MAP?1:0)|(i.colorLocked?1:0)<<1,this._materialKey=L.data,this._decoration="none",this._lineHeight=1,this._lineWidth=512,this._isCIM=!0}static fromCIMText(i,r){const[n,s]=(0,S._f)(i.scaleInfo,r);return new fe(i,n,s)}analyze(i,r,n,s){var c=()=>super.analyze,u=this;return(0,Y.Z)(function*(){const f=r.readLegacyFeature(),_=function Ke(l,i,r,n){return"string"==typeof l.text?l.text:"function"==typeof l.text?l.text(i,r,n):""}(u._cimTextLayer,f,n,s),M=yield c().call(u,i,r,n,s,(0,Me._)(_));return M&&M.glyphMosaicItems&&u._textToGlyphs.set(_,M.glyphMosaicItems),M})()}bindFeature(i,r,n){const s=i.readLegacyFeature();if(this._dynamicPropertyMap.forEach((u,f)=>{this[f]=u(s,r,n)}),!this._text||0===this._text.length)return void(this._shapingInfo=null);this._size*=this._scaleFactor,this._scale=this._size/V.Ex,this._xOffset*=this._scaleFactor,this._yOffset*=this._scaleFactor,this._xAlignD=(0,ge.kH)(this._horizontalAlignment||"center"),this._yAlignD=(0,ge.b7)(this._verticalAlignment||"baseline");const c=this._textToGlyphs.get(this._text);this.bindTextInfo(c,!1)}}const jt=128;class Xt extends(xe(ae.Z)){constructor(i,r,n,s,c,u,f,_,M,v,E,C,P,L,z,et){super(),this._effects=L;const it=J.dk.load(i);r&&(it.sdf=r.sdf,it.pattern=!0,it.textureBinding=r.textureBinding),this.fillColor=n,this.tl=s,this.br=c,this.aux2=(0,g.Jz)(u,f,_,M),this.aux3=(0,g.Jz)(v,E,C,0),this._bitset=P,this._minMaxZoom=(0,g.UJ)(Math.round(z*V.MI),Math.round(et*V.MI)),this._materialKey=it.data}static fromCIMFill(i,r,n){const s=i.color,c=s&&(0,H.t2)(s)||0,u=i.materialKey,[f,_]=(0,S._f)(i.scaleInfo,n);if(!r)return new Xt(u,null,c,0,0,0,0,0,0,0,0,0,i.colorLocked?V.Uh:0,i.effects,f,_);const{rect:M,width:v,height:E}=r,P=M.x+V.fL,L=M.y+V.fL,z=P+v,et=L+E,it=i.height,yt=(i.scaleX||1)*it;let Dt=Math.round(it);Dt>255?Dt=255:Dt<=0&&(Dt=et-L);let Ct=Math.round(yt);Ct>255?Ct=255:Ct<=0&&(Ct=z-P);let Zt=(0,k.F2)(i.offsetX||0)+jt;Zt>255&&(Zt=255);let Yt=(0,k.F2)(-i.offsetY||0)+jt;Yt>255&&(Yt=255);const Qt=(0,g.UJ)(P,L),$t=(0,g.UJ)(z,et);return new Xt(u,r,c,Qt,$t,Ct,Dt,Zt,Yt,jt,jt,(0,Tt.s5)(i.angle),i.colorLocked?V.Uh:0,i.effects,f,_)}static fromSimpleFill(i,r,n=!1){const{color:s}=i,c=s&&"esriSFSNull"!==i.style&&(0,H.aH)(s)||0,u=n?V.Uh:0,f=i.materialKey;let _;if(r){const{rect:M,width:v,height:E}=r,C=M.x+V.fL,P=M.y+V.fL,L=C+v,z=P+E,et=(0,g.UJ)(C,P),it=(0,g.UJ)(L,z);_=new Xt(f,r,c,et,it,v,E,0,0,jt,jt,0,u,null,S.Xe,S.eW)}else _=new Xt(f,null,c,0,0,0,0,0,0,0,0,0,u,null,S.Xe,S.eW);return _._maybeAddLineTemplate(i),_}static fromPictureFill(i,r,n=!1){const s=V.ru,{rect:c,width:u,height:f}=r,_=c.x+V.fL,M=c.y+V.fL,v=_+u,E=M+f,C=(0,g.UJ)(_,M),P=(0,g.UJ)(v,E);let L=Math.round((0,k.F2)(i.width));L>255&&(L=255);let z=Math.round((0,k.F2)(i.height));z>255&&(z=255);let et=(0,k.F2)(i.xoffset)+jt;et>255&&(et=255);let it=(0,k.F2)(-i.yoffset)+jt;it>255&&(it=255);const Ct=new Xt(i.materialKey,r,s,C,P,L,z,et,it,jt*i.xscale,jt*i.yscale,0,n?V.Uh:0,null,S.Xe,S.eW);return Ct._maybeAddLineTemplate(i),Ct}}var re=d(18752),Le=d(51919);class Ge{constructor(){this._resolver=null}isHeld(){return!!this._resolver}acquire(){var i=this;return(0,Y.Z)(function*(){if(!i._resolver)return i._resolver=(0,F.hh)(),Promise.resolve();yield i._resolver.promise,yield i.acquire()})()}release(){const i=this._resolver;this._resolver=null,i.resolve()}}function _e(){return(_e=(0,Y.Z)(function*(l,i,r){try{yield l.acquire(),yield i(r),l.release()}catch(n){throw l.release(),n}})).apply(this,arguments)}var se=d(11263);const Rt=ct.Z.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),Pe=new Array,de={isOutline:!1,isOutlinedFill:!1,placement:null,stride:{fill:"default"},vvFlags:0},je=te(qt({},R.eG),{hash:JSON.stringify(R.eG),materialKey:(0,J.jj)(Q.LW.MARKER,de)}),Je=te(qt({},R.wW),{hash:JSON.stringify(R.wW),materialKey:(0,J.jj)(Q.LW.LINE,de)}),ke=te(qt({},R.lj),{hash:JSON.stringify(R.lj),materialKey:(0,J.jj)(Q.LW.FILL,de)});function Nt(l,i){const r=l.length;return l.push(null),i.then(n=>l[r]=n),l}function We(l){return!!(1&l)}class Ne{constructor(i,r){this._idCounter=1,this._templateIdCounter=1,this._idToTemplateGroup=new Map,this._symbolToTemplate=new Map,this._fetchQueue=[],this._idToResolver=new Map,this._cimTemplateCache=new Map,this._cimAnalyses=[],this._lock=new Ge,this._fetchResource=i,this._tileInfo=r}get _markerError(){return this._errorTemplates.marker[0]}get _fillError(){return this._errorTemplates.fill[0]}get _lineError(){return this._errorTemplates.line[0]}get _textError(){return this._errorTemplates.line[0]}createTemplateGroup(i,r){this._initErrorTemplates();const n=i.hash;if(this._symbolToTemplate.has(n))return this._symbolToTemplate.get(n);const s=new Array;r&&this._createMeshTemplates(s,r,!0),this._createMeshTemplates(s,i,!1);const c=this._createGroupId("expanded-cim"===i.type&&He(i));return this._idToTemplateGroup.set(c,s),this._symbolToTemplate.set(n,c),c}getTemplateGroup(i){return this._idToTemplateGroup.has(i)?this._idToTemplateGroup.get(i):Pe}getDynamicTemplateGroup(i){return this._idToTemplateGroup.has(i)?(We(i)||Rt.error("mapview-template-store",`Id ${i} does not refer to a dynamic template`),this._idToTemplateGroup.get(i)):Pe}getMosaicItem(i,r){const n=this._createTemplateId(),s=new Promise(c=>this._idToResolver.set(n,c));return this._fetchQueue.push({symbol:i,id:n,glyphIds:r}),s}finalize(i){return this._fetchQueue.length||this._lock.isHeld()?function Ve(l,i,r){return _e.apply(this,arguments)}(this._lock,this._fetchAllQueuedResources.bind(this),i):Promise.resolve()}_initErrorTemplates(){this._errorTemplates||(this._errorTemplates={fill:this._createMeshTemplates([],ke,!1),marker:this._createMeshTemplates([],je,!1),line:this._createMeshTemplates([],Je,!1)})}_fetchAllQueuedResources(i){if(!this._fetchQueue.length)return Promise.resolve();const r=this._fetchQueue,n=this._cimAnalyses;return this._fetchQueue=[],this._cimAnalyses=[],Promise.all(n).then(()=>this._fetchResource(r,i).then(s=>{for(const{id:c,mosaicItem:u}of s)this._idToResolver.get(c)(u),this._idToResolver.delete(c)})).catch(s=>{(0,F.D_)(s)?this._fetchQueue=this._fetchQueue.concat(r):function Xe(l){return"worker:port-closed"===l.name}(s)||Rt.error(new ot.Z("mapview-template-store","Unable to fetch requested texture resources",s))})}_createGroupId(i){return this._idCounter++<<1|(i?1:0)}_createTemplateId(){return this._templateIdCounter++}_createSMS(i){var r=this;return(0,Y.Z)(function*(){const{spriteMosaicItem:n}=yield r.getMosaicItem(i);return(0,Ut.ok)(n,Rt)?re.Z.fromSimpleMarker(i,n):r._markerError})()}_createPMS(i){var r=this;return(0,Y.Z)(function*(){const{spriteMosaicItem:n}=yield r.getMosaicItem(i);return(0,Ut.ok)(n,Rt)?re.Z.fromPictureMarker(i,n):r._markerError})()}_createSFS(i,r){var n=this;return(0,Y.Z)(function*(){const{spriteMosaicItem:s}=yield n.getMosaicItem(i);return(0,Ut.ok)(s,Rt)?Xt.fromSimpleFill(i,s,r):n._fillError})()}_createPFS(i,r){var n=this;return(0,Y.Z)(function*(){const{spriteMosaicItem:s}=yield n.getMosaicItem(i);return(0,Ut.ok)(s,Rt)?Xt.fromPictureFill(i,s,r):n._fillError})()}_createSLS(i,r){var n=this;return(0,Y.Z)(function*(){const{spriteMosaicItem:s}=yield n.getMosaicItem(i);return(0,Ut.ok)(s,Rt)?kt.fromSimpleLine(i,s):n._lineError})()}_createLMS(i){var r=this;return(0,Y.Z)(function*(){const{spriteMosaicItem:n}=yield r.getMosaicItem(i);return(0,Ut.ok)(n,Rt)?re.Z.fromLineSymbolMarker(i,n):r._markerError})()}_createTS(i){var r=this;return(0,Y.Z)(function*(){const{glyphMosaicItems:n}=yield r.getMosaicItem(i);return Le.Z.fromText(i,n)})()}_createCIMText(i){var r=this;return(0,Y.Z)(function*(){const{glyphMosaicItems:n}=yield r.getMosaicItem((0,se.xS)(i),(0,Me._)(i.text));return(0,Ut.ok)(n,Rt)?Le.Z.fromCIMText(i,n,r._tileInfo):r._textError})()}_createCIMFill(i){var r=this;return(0,Y.Z)(function*(){const{spriteMosaicItem:n}=yield r.getMosaicItem((0,se.xS)(i));return(0,Ut.ok)(n,Rt)?Xt.fromCIMFill(i,n,r._tileInfo):r._fillError})()}_createCIMLine(i){var r=this;return(0,Y.Z)(function*(){const{spriteMosaicItem:n}=yield r.getMosaicItem((0,se.xS)(i));return(0,Ut.ok)(n,Rt)?kt.fromCIMLine(i,n,r._tileInfo):r._lineError})()}_createCIMMarker(i){var r=this;return(0,Y.Z)(function*(){const{spriteMosaicItem:n}=yield r.getMosaicItem((0,se.xS)(i));return(0,Ut.ok)(n,Rt)?re.Z.fromCIMMarker(i,n,r._tileInfo):r._markerError})()}_createCIM(i){var r=this;return(0,Y.Z)(function*(){const n=i.templateHash;if(r._cimTemplateCache.has(n))return r._cimTemplateCache.get(n);let s;switch(i.type){case"marker":s=yield r._createCIMMarker(i);break;case"line":s=yield r._createCIMLine(i);break;case"fill":s=yield r._createCIMFill(i);break;case"text":s=yield r._createCIMText(i)}return r._cimTemplateCache.set(n,s),s})()}_createDynamicCIM(i){var r=this;return(0,Y.Z)(function*(){const n=i.templateHash;if(r._cimTemplateCache.has(n))return r._cimTemplateCache.get(n);let s;switch(i.type){case"marker":s=ue.fromCIMMarker(i,r._tileInfo);break;case"line":s=ce.fromCIMLine(i,r._tileInfo);break;case"fill":s=he.fromCIMFill(i,r._tileInfo);break;case"text":s=fe.fromCIMText(i,r._tileInfo)}return r._cimTemplateCache.set(n,s),s})()}_createPrimitiveMeshTemplates(i,r,n){switch(r.type){case"esriSMS":return Nt(i,this._createSMS(r));case"esriPMS":return Nt(i,this._createPMS(r));case"esriSFS":return Nt(i,this._createSFS(r,n));case"line-marker":return Nt(i,this._createLMS(r));case"esriPFS":return Nt(i,this._createPFS(r,n));case"esriSLS":return Nt(i,this._createSLS(r,!1));case"esriTS":return Nt(i,this._createTS(r));default:return Rt.error("Unable to create mesh template for unknown symbol type {: $ }{symbol.type}"),i}}_createMeshTemplates(i,r,n){if(-1!==r.type.indexOf("3d"))return Rt.error("3D symbols are not supported with MapView"),i;if("expanded-cim"===r.type){for(const s of r.layers)Nt(i,"function"==typeof s.materialHash?this._createDynamicCIM(s):this._createCIM(s));return i}if("composite-symbol"===r.type){for(const s of r.layers)this._createPrimitiveMeshTemplates(i,s,n);return i}return"cim"===r.type||"label"===r.type||"web-style"===r.type?i:this._createPrimitiveMeshTemplates(i,r,n)}}const He=l=>{if(!l.layers)return!1;for(const i of l.layers)if("function"==typeof i.materialHash)return!0;return!1}},51919:(Et,dt,d)=>{d.d(dt,{Z:()=>g});var Y=d(986),ot=d(23841),ct=d(7547),F=d(61261),R=d(81295),Q=d(39351),J=d(5254),U=d(18716),k=d(50114),H=d(44526),V=d(94358);class g extends((0,H.Z)(V.Z)){constructor(a,y,Z,$,q,D,B,x,W,A,rt,st,j,lt,ut,vt,xt,T,N=!1,nt,K){super(),this._xOffset=(0,ot.F2)(j),this._yOffset=(0,ot.F2)(lt),this._decoration=A||"none",this._color=q,this._haloColor=D,this._haloSize=Math.min(Math.floor(5*(0,ot.F2)((0,ot.t_)(Z))),127),this._size=Math.min(Math.round((0,ot.F2)(y)),127);const at=Math.min(Math.round((0,ot.F2)($||y)),127);this._referenceSize=Math.round(Math.sqrt(256*at)),this._scale=this._size/Q.Ex,this._angle=st,this._justify=(0,F.Hd)(B||"center"),this._xAlignD=(0,F.kH)(B||"center"),this._yAlignD=(0,F.b7)(x||"baseline"),this._baseline="baseline"===(x||"baseline"),this._bitset=(W===ct.v2.MAP?1:0)|(rt?1:0)<<1;const mt=U.m2.load(a);mt.sdf=!0,this._materialKey=mt.data,this._lineWidth=(0,ot.F2)(ut)||512,this._lineHeight=vt||1,this._textPlacement=xt,this._effects=T,this._isCIM=N,this._minMaxZoom=(0,J.UJ)(Math.round(nt*Q.MI),Math.round(K*Q.MI))}static fromText(a,y){const Z=new g(a.materialKey,a.font.size,a.haloSize||0,a.font.size,a.color&&(0,R.aH)(a.color)||0,a.haloColor&&(0,R.aH)(a.haloColor)||0,a.horizontalAlignment,a.verticalAlignment,ct.v2.SCREEN,a.font.decoration,!1,a.angle||0,a.xoffset,a.yoffset,a.lineWidth,a.lineHeight,null,null,!1,k.Xe,k.eW),[,$]=(0,Y.E)(a.text);return Z.bindTextInfo(y,$),Z._vertexBoundsScale=a.maxVVSize?a.maxVVSize/a.font.size:1,Z}static fromCIMText(a,y,Z){const $=a.scaleFactor||1,q=a.size*a.sizeRatio*$,[D,B]=(0,k._f)(a.scaleInfo,Z),x=new g(a.materialKey,q,a.outlineSize*a.sizeRatio,a.referenceSize,(0,R.t2)(a.color),(0,R.t2)(a.outlineColor),a.horizontalAlignment,a.verticalAlignment,a.alignment,a.decoration,a.colorLocked,a.angle,a.offsetX*a.sizeRatio*$,a.offsetY*a.sizeRatio*$,512,1,a.markerPlacement,a.effects,!0,D,B),[,W]=(0,Y.E)(a.text);return x.bindTextInfo(y,W),x._vertexBoundsScale=a.maxVVSize?a.maxVVSize/q:1,x}}},50114:(Et,dt,d)=>{d.d(dt,{Fv:()=>R,NW:()=>U,TK:()=>Q,Xe:()=>Y,_f:()=>S,eW:()=>ot,lu:()=>ct,mf:()=>J});const Y=0,ot=100;function ct(a,y,Z){return a[0]=y[0]-Z[0],a[1]=y[1]-Z[1],a}function F(a,y){return Math.sqrt(a*a+y*y)}function R(a){const y=F(a[0],a[1]);a[0]/=y,a[1]/=y}function Q(a,y){return F(a[0]-y[0],a[1]-y[1])}function J(a){return"function"==typeof a}function U(a=2){return 1/Math.max(a,1)}function S(a,y){return[!!a.minScale&&y.scaleToZoom(a.minScale)||Y,!!a.maxScale&&y.scaleToZoom(a.maxScale)||ot]}},32940:(Et,dt,d)=>{d.d(dt,{fL:()=>k});var Y=d(15861),ot=d(26584),ct=d(63290),F=d(93961),R=d(46679),Q=d(39236),J=d(11263);const U=ct.Z.getLogger("esri/views/2d/engine/webgl/util/Matcher");function k(B,x,W,A){return H.apply(this,arguments)}function H(){return(H=(0,Y.Z)(function*(B,x,W,A){switch(B.type){case"simple":return V.fromBasicRenderer(B,x,W,A);case"map":return S.fromUVRenderer(B,x,W,A);case"interval":return g.fromCBRenderer(B,x,W,A);case"dictionary":return D.fromDictionaryRenderer(B,x,W,A);case"subtype":return Tt.fromSubtypes(B,x,W,A)}})).apply(this,arguments)}class V{constructor(){this.type="feature",this._defaultResult=null}static fromBasicRenderer(x,W,A,rt){return(0,Y.Z)(function*(){const st=new V;if(x.symbol){const j=yield(0,J.B3)(x.symbol,A,rt),lt=W.createTemplateGroup(j,null);st.setDefault(lt)}return st})()}size(){return 1}getDefault(){return this._defaultResult}setDefault(x){this._defaultResult=x}match(x,W,A,rt,st){return this.getDefault()}analyze(x,W,A,rt,st,j){return(0,Y.Z)(function*(){return null})()}}class Tt extends V{constructor(x,W){super(),this._subMatchers=x,this._subtypeField=W}static fromSubtypes(x,W,A,rt){return(0,Y.Z)(function*(){const st=new Map,j=[];for(const lt in x.renderers){const ut=parseInt(lt,10),vt=k(x.renderers[lt],W,A,rt).then(xt=>st.set(ut,xt));j.push(vt)}return yield Promise.all(j),new Tt(st,x.subtypeField)})()}match(x,W,A,rt,st){const j=W.readAttribute(this._subtypeField),lt=this._subMatchers.get(j);return lt?lt.match(x,W,A,rt,st):null}}class g extends V{constructor(x,W,A,rt){super(),this.type="interval",this._intervals=[],this._isMaxInclusive=W,this._fieldIndex=rt,this._field=x,this._normalizationInfo=A}static fromCBRenderer(x,W,A,rt){return(0,Y.Z)(function*(){const{isMaxInclusive:st,normalizationField:j,normalizationTotal:lt,normalizationType:ut}=x,xt=new g(x.field,st,{normalizationField:j,normalizationTotal:lt,normalizationType:ut},x.fieldIndex),T=yield(0,J.B3)(x.backgroundFillSymbol,A,rt);yield Promise.all(x.intervals.map(function(){var nt=(0,Y.Z)(function*(K){const at=yield(0,J.B3)(K.symbol,A,rt),mt=yield W.createTemplateGroup(at,T);xt.add({min:K.min,max:K.max},mt)});return function(K){return nt.apply(this,arguments)}}()));const N=yield(0,J.B3)(x.defaultSymbol,A,rt);if(N){const nt=yield W.createTemplateGroup(N,T);xt.setDefault(nt)}return xt})()}add(x,W){this._intervals.push({interval:x,result:W}),this._intervals.sort((A,rt)=>A.interval.min-rt.interval.min)}size(){return super.size()+this._intervals.length}match(x,W,A,rt,st){if(null==this._fieldIndex&&!this._field)return this.getDefault();const j=null!=this._fieldIndex?W.getComputedNumericAtIndex(this._fieldIndex):this._getValueFromField(W);if(!j&&(null==j||isNaN(j)))return this.getDefault();for(let lt=0;lt<this._intervals.length;lt++){const{interval:ut,result:vt}=this._intervals[lt],T=this._isMaxInclusive?j<=ut.max:j<ut.max;if(j>=ut.min&&T)return vt}return this.getDefault()}_needsNormalization(){const x=this._normalizationInfo;return x&&(x.normalizationField||x.normalizationTotal||x.normalizationType)}_getValueFromField(x){const W=x.readAttribute(this._field);if(!this._needsNormalization()||null==W)return W;const{normalizationField:A,normalizationTotal:rt,normalizationType:st}=this._normalizationInfo,j=!!A&&x.readAttribute(A);if(st)switch(st){case"esriNormalizeByField":return j?W/j:void 0;case"esriNormalizeByLog":return Math.log(W)*Math.LOG10E;case"esriNormalizeByPercentOfTotal":return W/rt*100;default:return void U.error(`Found unknown normalization type: ${st}`)}else U.error("Normalization is required, but no type was set!")}}class S extends V{constructor(x,W,A){super(),this.type="map",this._nullResult=null,this._resultsMap=new Map,this._fieldsIndex=A,this._fields=x,this._seperator=W||""}static fromUVRenderer(x,W,A,rt){return(0,Y.Z)(function*(){const st=x.fieldDelimiter,j=[x.field];x.field2&&j.push(x.field2),x.field3&&j.push(x.field3);const lt=yield(0,J.B3)(x.backgroundFillSymbol,A,rt),ut=new S(j,st,x.fieldIndex);yield Promise.all(x.map.map(function(){var xt=(0,Y.Z)(function*(T){const N=yield(0,J.B3)(T.symbol,A,rt),nt=yield W.createTemplateGroup(N,lt);"<Null>"===T.value?ut.setNullResult(nt):ut.add(T.value,nt)});return function(T){return xt.apply(this,arguments)}}()));const vt=yield(0,J.B3)(x.defaultSymbol,A,rt);if(vt){const xt=yield W.createTemplateGroup(vt,lt);ut.setDefault(xt)}return ut})()}setNullResult(x){this._nullResult=x}add(x,W){this._resultsMap.set(x.toString(),W)}size(){return super.size()+this._resultsMap.size}match(x,W,A,rt,st){if(null==this._fieldsIndex&&!this._fields)return this.getDefault();const j=null!=this._fieldsIndex?W.getComputedStringAtIndex(this._fieldsIndex):this._getValueFromFields(W);if(null!==this._nullResult&&(null==j||""===j||"<Null>"===j))return this._nullResult;if(!j&&null==j)return this.getDefault();const lt=j.toString();return this._resultsMap.has(lt)?this._resultsMap.get(lt):this.getDefault()}_getValueFromFields(x){const W=[];for(const A of this._fields){const rt=x.readAttribute(A);W.push(null==rt||""===rt?"<Null>":rt)}return W.join(this._seperator)}}function y(){return(y=(0,Y.Z)(function*(B,x){const W=B||1;if("number"==typeof W)return(rt,st,j)=>W;const A=yield(0,R.Yi)(W,x.spatialReference,x.fields);return(rt,st,j)=>(0,Q.Z)(A,rt,{$view:j},x.geometryType,st)||1})).apply(this,arguments)}let Z;function $(){return q.apply(this,arguments)}function q(){return(q=(0,Y.Z)(function*(){return Z||(Z=d.e(3250).then(d.bind(d,3250))),Z})).apply(this,arguments)}class D extends V{constructor(x,W,A,rt,st,j){super(),this.type="dictionary",this._groupIdCache=new F.Z(100),this._loader=x,this._fieldMap=x.fieldMap,this._symbolFields=x.getSymbolFields(),this._templates=W,this._info=A,this._scaleFn=rt,this._schemaUtilsModule=st,this._symbolOptions=j}static fromDictionaryRenderer(x,W,A,rt){return(0,Y.Z)(function*(){const[{DictionaryLoader:st},j]=yield Promise.all([Promise.resolve().then(d.bind(d,29996)),$()]),lt=new st(x.url,x.config,x.fieldMap);yield lt.fetchResources({spatialReference:A.spatialReference,fields:A.fields});const ut=yield function a(B,x){return y.apply(this,arguments)}(x.scaleExpression,A);return new D(lt,W,A,ut,j,x.symbolOptions)})()}_analyzeFeature(x,W,A,rt,st){var j=this;return(0,Y.Z)(function*(){const lt=x.readLegacyFeature(),ut=j._scaleFn(lt,A,rt),vt=j._attributeHash(lt)+"-"+ut,xt=j._groupIdCache.get(vt);if(xt)return xt;const T=te(qt({},rt),{spatialReference:j._info.spatialReference,abortOptions:st,fields:j._info.fields}),N=yield j._loader.getSymbolAsync(lt,T),nt=j._schemaUtilsModule.createSymbolSchema(N,j._symbolOptions),K=(0,J.B3)(nt,j._info,W,st).then(at=>{if("expanded-cim"!==at.type)return U.error(new ot.Z("mapview-bad-type",`Found unexpected type ${at.type} in dictionary response`)),null;at.hash+="-"+ut;for(const mt of at.layers)mt.scaleFactor=ut,mt.templateHash+="-"+ut;return j._templates.createTemplateGroup(at,null)});return j._groupIdCache.put(vt,K,1),K})()}analyze(x,W,A,rt,st,j){var lt=this;return(0,Y.Z)(function*(){const ut=W.getCursor(),vt=[];for(;ut.next();)vt.push(lt._analyzeFeature(ut,A,rt,st,j));return Promise.all(vt)})()}match(x,W,A,rt,st){return null}_attributeHash(x){let W="";for(const A of this._symbolFields){const rt=this._fieldMap[A];rt&&(W+=x.attributes[rt]+"-")}return W}}},84450:(Et,dt,d)=>{d.d(dt,{ok:()=>ot});var Y=d(26584);function ot(ct,F){if(ct&&"name"in ct){const R=ct;return F&&F.error(new Y.Z(R.name,R.message,R.details)),!1}return!0}},75734:(Et,dt,d)=>{d.d(dt,{Z:()=>ot});class ot{constructor(F,R){this._pos=0;const Q=R?this._roundToNearest(R,F.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(Q),this._buffer=new F(this._array),this._ctor=F,this._i16View=new Int16Array(this._array)}get length(){return this._pos}_roundToNearest(F,R){const Q=Math.round(F);return Q+(R-Q%R)}_ensureSize(F){if(this._pos+F>=this._buffer.length){const R=this._roundToNearest(1.25*(this._array.byteLength+F*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),Q=new ArrayBuffer(R),J=new this._ctor(Q);J.set(this._buffer,0),this._array=Q,this._buffer=J,this._i16View=new Int16Array(this._array)}}ensureSize(F){this._ensureSize(F)}writeF32(F){this._ensureSize(1);const R=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=F,this._pos++,R}push(F){this._ensureSize(1);const R=this._pos;return this._buffer[this._pos++]=F,R}writeFixed(F){this._buffer[this._pos++]=F}setValue(F,R){this._buffer[F]=R}i1616Add(F,R,Q){this._i16View[2*F]+=R,this._i16View[2*F+1]+=Q}getValue(F){return this._buffer[F]}incr(F){if(this._buffer.length<F)throw new Error("Increment index overflows the target buffer");this._buffer[F]++}decr(F){this._buffer[F]--}writeRegion(F){this._ensureSize(F.length);const R=this._pos;return this._buffer.set(F,this._pos),this._pos+=F.length,R}writeManyFrom(F,R,Q){this._ensureSize(Q-R);for(let J=R;J!==Q;J++)this.writeFixed(F._buffer[J])}buffer(){const F=this._array.slice(0,4*this._pos);return this.destroy(),F}toArray(){const F=this._array,R=[];for(let Q=0;Q<F.byteLength/4;Q++)R.push(F[Q]);return R}seek(F){this._pos=F}destroy(){this._array=null,this._buffer=null}}},55376:(Et,dt,d)=>{function ct(F,R,Q,J){const U=F.clone(),k=1<<U.level,H=U.col+R,V=U.row+Q;return J&&H<0?(U.col=H+k,U.world-=1):H>=k?(U.col=H-k,U.world+=1):U.col=H,U.row=V,U}d.d(dt,{M:()=>ct}),d(81340)},32954:(Et,dt,d)=>{function Y(ot){const ct=new Array(ot.length);for(let F=0;F<ot.length;F++)ct[F]=ot.charCodeAt(F);return ct}d.d(dt,{_:()=>Y})}}]);